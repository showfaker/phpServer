<!DOCTYPE html>
<html>
<head> 
<meta charset="utf-8" /> 
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" /> 
<title>上传进度</title> 
<link href="__PUBLIC__/appsource/css/mui.css" rel="stylesheet" /> 
<script type="text/javascript" src="__PUBLIC__/appsource/js/common.js"></script>
<link href="__PUBLIC__/appsource/css/mui.picker.css" rel="stylesheet" />
<link href="__PUBLIC__/appsource/css/mui.poppicker.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="__PUBLIC__/appsource/css/mui.picker.min.css" />
<link rel="stylesheet" href="__PUBLIC__/appsource/css/common.css" type="text/css" charset="utf-8"/>
<link href="css/plugins/chosen/chosen.css" rel="stylesheet">

<link href="css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
<link href="css/font-awesome.css?v=4.4.0" rel="stylesheet">
<link href="css/plugins/iCheck/custom.css" rel="stylesheet">
<link href="css/animate.css" rel="stylesheet">
<link href="css/style.css?v=4.1.0" rel="stylesheet">
<link rel="stylesheet" href="css/main1.css">
<link rel="stylesheet" href="css/core1.css">
<style>
.normal{
	font-size:14px;
	height:80px;
}
</style>
<script>
var sortnum=0;
function parentreload()
{
	//parent.parentreload();
}
function iframeCallback_sgrz()
{
	//parentreload();
}

</script>
</head>
<body> 
<div class="mui-content mui-scroll mui-scroll-wrapper" id="plmid" <eq name="_SESSION[app]" value="1">style="overflow-x:auto;background-color:white;padding-top:10px"</eq> style="overflow-y:hidden;background-color:white;padding-top:10px">
<form method="post" action="__APP__/Sgrz/dailysubmit/callbackType/closeCurrent/navTabId/Second" id="sgrzform" ENCTYPE="multipart/form-data" onsubmit="return iframeCallback_sgrz()">


<eq name="plmid" value="">
<div style="overflow-y:scroll;height:600px;padding:10px">
<div style="margin-bottom:10px;">
	<form action="__URL__/index/token/{$token}/" method="post">
		<input type="hidden" value="{$tab}" name="tab">
		<div style="width:100%;" class="input-group">
			<div class="input-group col-sm-6 col-xs-6" style="float:left;padding-right:20px">
			<span class="input-group-addon">项目名称</span>
			<input type="" name="title" value="{$title}" class="form-control" id="myInput" oninput="myFunction()">
			</div>
			<!-- <button class="btn btn-primary btn-sm" style="float:left;margin-right:10px" type="submit">查询</button> -->
			<script>
				function myFunction() { //如果有搜索按钮，定义一个onclick即可
				  // 声明变量
				  var input, filter, table, tr, td, i;
				  input = document.getElementById("myInput");
				  filter = input.value.toUpperCase(); //toUpperCase()是不区分大小写
				  table = document.getElementById("myTable");
				  tr = table.getElementsByTagName("tr");
				 
				  // 循环表格每一行，查找匹配项
				  for (i = 0; i < tr.length; i++) {
					td = tr[i].getElementsByTagName("td")[0]; //这个0时要搜索第1列的内容，以此类推
					if (td) {
					  if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {  //如果要区分大小写就去掉这个toUpperCase()
						tr[i].style.display = "";
					  } else {
						tr[i].style.display = "none";
					  }
					} 
				  }
				}
			</script>
		</div>
	</form>
</div>
<table class="table table-striped table-bordered table-hover" id="myTable">
	<thead>
		<tr>			
			<th width="15%">项目名称</th>
			<th width="5%">项目状态</th>
			<th width="10%">节点设置状态</th>
			<th width="10%">计划设置状态</th>
			<th width="5%">操作</th>
		</tr>
	</thead>
	<tbody id="plmbox">
	</tbody>	
</table>
</div>
</eq>




<table <eq name="plmid" value="">style="height:auto;width:96%;display:none"</eq> style="height:auto;width:96%" class="drafttable"> 
	<tr class="mui-table-view" style="margin-top:0px">
		<td class="normal"><select class="chosen-select" name="xuanzexiangmu" <eq name="_SESSION[app]" value="1">style="background-color:transparent;color:#777;margin-left:10px;border:0px;width:100%;padding:0px"</eq> style="background-color:transparent;color:#777;margin-left:10px;border:0px;width:100%" placeholder="选择项目"></select></td>
	</tr>
	
	<tr class="mui-table-view" style="margin-top:0px">
	<td class="normal">
		<div style="height:500px;overflow-y:scroll;overflow-x:hidden">
		<table class="drafttable" style="position:relative;top:8px;margin:0 auto;width:100%;font-family:微软雅黑;">
			<tr>
				<td class="normal" style="font-weight:bold;height:45px;background-color:#F5F5F6;" <eq name="_SESSION[app]" value="1">width="8%"</eq>>专项</td>
				<eq name="moduletitle" value="采购进度管理">
				<td class="normal" style="font-weight:bold;height:45px;background-color:#F5F5F6;" <eq name="_SESSION[app]" value="1">width="8%"</eq>>批次</td>
				<td class="normal" style="font-weight:bold;height:45px;background-color:#F5F5F6;" <eq name="_SESSION[app]" value="1">width="8%"</eq>>计划数量</td>
				</eq>
				<td class="normal" style="font-weight:bold;height:45px;background-color:#F5F5F6;" <eq name="_SESSION[app]" value="1">width="8%"</eq>>节点</td>
				<td class="normal" style="font-weight:bold;height:45px;background-color:#F5F5F6" <eq name="_SESSION[app]" value="1">width="8%"</eq>>计划开始</td>
				<td class="normal" style="font-weight:bold;height:45px;background-color:#F5F5F6" <eq name="_SESSION[app]" value="1">width="8%"</eq>>计划完成</td>
				
				
				
				<td class="normal" style="font-weight:bold;height:45px;background-color:#F5F5F6" <eq name="_SESSION[app]" value="1">width="8%"</eq>>今日计划</td>
				
				<eq name="moduletitle" value="施工进度管理">
				<td class="normal" style="font-weight:bold;height:45px;background-color:#F5F5F6" <eq name="_SESSION[app]" value="1">width="8%"</eq>>工程量</td>
				<td class="normal" style="font-weight:bold;height:45px;background-color:#F5F5F6" <eq name="_SESSION[app]" value="1">width="8%"</eq>>已完成</td>
				<td class="normal" style="font-weight:bold;height:45px;background-color:#F5F5F6" <eq name="_SESSION[app]" value="1">width="8%"</eq>>今日完成</td>
				</eq>
				
				<td class="normal" style="font-weight:bold;height:45px;background-color:#F5F5F6" <eq name="_SESSION[app]" value="1">width="8%"</eq>>今日实际</td>
				
				<td class="normal" style="font-weight:bold;height:45px;background-color:#F5F5F6" <eq name="_SESSION[app]" value="1">width="8%"</eq>>备注</td>
				<td class="normal" style="font-weight:bold;height:45px;background-color:#F5F5F6" <eq name="_SESSION[app]" value="1">width="8%"</eq>>附件</td>
				
				<in name="moduletitle" value="采购进度管理,开发进度管理">
				<td class="normal" style="font-weight:bold;height:45px;background-color:#F5F5F6" <eq name="_SESSION[app]" value="1">width="8%"</eq>>保管人</td>
				</in>
			</tr>
			
			<volist name="schedules" id="schedule">
			<input type="hidden" name="scheduleid[]" value="{$schedule.id}">
			<tr>
				<eq name="schedule.block" value="1">
				<td class="normal" rowspan="{$schedule.rowspan}" <eq name="_SESSION[app]" value="1">style="font-weight:bold;height:45px;word-break:break-all;word-wrap:break-word;"</eq> style="font-weight:bold;height:45px">{$schedule.worktype}</td>
				</eq>
				
				
				<eq name="moduletitle" value="采购进度管理">
				<in name="key" value="0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76">
				<td class="normal" rowspan="4" >
				<input class="form-control" type="hidden" name="branch[]" title="占位">
				<input class="form-control" type="hidden" name="branch[]" title="占位">
				<input class="form-control" type="hidden" name="branch[]" title="占位">
				<input value="{$schedules[$key+3][branch]}" class="form-control" type="text" name="branch[]" readonly <eq name="_SESSION[app]" value="1">style="width:40px;font-size:10px;"</eq> style="width:70px;font-size:14px">
				</td>
				<td class="normal" rowspan="4" >
				<input class="form-control" type="hidden" name="plancount[]" title="占位">
				<input class="form-control" type="hidden" name="plancount[]" title="占位">
				<input class="form-control" type="hidden" name="plancount[]" title="占位">
				<input value="{$schedules[$key+3][plancount]}" class="form-control" type="text" name="plancount[]" readonly <eq name="_SESSION[app]" value="1">style="width:40px;font-size:10px;"</eq> style="width:70px;font-size:14px">
				</td>
				</in>
				</eq>
				
				<td class="normal" title="{$schedule[id]}" <eq name="_SESSION[app]" value="1">style="word-break: break-all;word-wrap: break-word;"</eq>>
				<neq name="schedule.attribute">（{$schedule.attribute}）</neq>{$schedule.subworktype}
				</td>
				<td class="normal" >{$schedule[plantimebegin]}</td>
				<td class="normal" >{$schedule[plantimeend]}</td>
				
				
				<td class="normal" >{$schedule[planpercent]}<input value="{$schedule[planpercent]}" type="hidden" name="planpercent[]"></td>
				
				<eq name="moduletitle" value="施工进度管理">
				<td class="normal" >
				<neq name="schedule.qualityunit" value="">
				{$schedule[planquality]}{$schedule[qualityunit]}
				</neq>
				</td>
				<td class="normal" >
				<neq name="schedule.qualityunit" value="">
				{$schedule[realquality]}{$schedule[qualityunit]}
				</neq>
				</td>
				<td class="normal" >
				
				<neq name="schedule.qualityunit" value="">
				<neq name="schedule.realquality" value="">
				<input name="quality" <eq name="_SESSION[app]" value="1">style="width:40px;position:relative;top:1px"</eq> style="width:60px;position:relative;top:1px" oninput="calc(this.value,{$schedule[realquality]},{$schedule[planquality]},{$key})">
				</neq>
				<eq name="schedule.realquality" value="">
				<input name="quality" <eq name="_SESSION[app]" value="1">style="width:40px;position:relative;top:1px"</eq> style="width:60px;position:relative;top:1px" oninput="calc(this.value,0,{$schedule[planquality]},{$key})">
				</eq>
				<script>
					function calc(value,realquality,planquality,key)
					{
						var percent=Math.floor(100*(parseFloat(value)+parseFloat(realquality))/planquality);
						if(percent>100)percent=100;
						percent+="%";
						$("#percent"+key).val(percent);
						$("#percent"+key).trigger("chosen:updated");
					}
				</script>
				</neq>
				
				
				</td>
				</eq>
				
				<td class="normal" >
				
				<in name="moduletitle" value="开发进度管理,设计进度管理">
				<neq name="_SESSION[app]" value="1">
				<select class="chosen-select" name="percent[]" style="background-color:transparent;color:#777;margin-left:10px;border:0px;width:85px" placeholder="选择进度">
						<option value="0%">未完</option>
						<option value="100%" <eq name="schedule.percent" value="100%">selected</eq>>完成</option>
				</select>
				</neq>
				<eq name="_SESSION[app]" value="1">
				<select name="percent[]" style="width:35px;border:1px solid #ccc;padding:0px;outline: 1px solid #ccc;height:23px" placeholder="选择进度">
						<option value="0%">未完</option>
						<option value="100%" <eq name="schedule.percent" value="100%">selected</eq>>完成</option>
				</select>
				</eq>
				</in>
				
				
				
				<in name="moduletitle" value="采购进度管理">
				<notin name="schedule.subworktype" value="付款申请,到货情况">
				<neq name="_SESSION[app]" value="1">
				<select class="chosen-select" name="percent[]" style="background-color:transparent;color:#777;margin-left:10px;border:0px;width:85px" placeholder="选择进度">
						<option value="0%">未完</option>
						<option value="100%" <eq name="schedule.percent" value="100%">selected</eq>>完成</option>
				</select>
				</neq>
				<eq name="_SESSION[app]" value="1">
				<select name="percent[]" style="width:35px;border:1px solid #ccc;padding:0px;outline: 1px solid #ccc;height:23px" placeholder="选择进度">
						<option value="0%">未完</option>
						<option value="100%" <eq name="schedule.percent" value="100%">selected</eq>>完成</option>
				</select>
				</eq>
				<input type="hidden" name="daohuoshuliang[]">
				</notin>
				
				<eq name="schedule.subworktype" value="付款申请">
				<neq name="_SESSION[app]" value="1">
				<select class="chosen-select" name="percent[]" id="percent{$key}" style="background-color:transparent;color:#777;margin-left:10px;border:0px;width:85px" placeholder="选择进度">
					<?php for($i=$schedule["percentdigit"];$i<=100;$i++) {?>
						<option value="<?php echo $i."%"; ?>"><?php echo $i;?>%</option>
					<?php } ?>
				</select>
				</neq>
				<eq name="_SESSION[app]" value="1">
				<select name="percent[]" id="percent{$key}" style="width:35px;border:1px solid #ccc;padding:0px;outline: 1px solid #ccc;height:23px" placeholder="选择进度">
					<?php for($i=$schedule["percentdigit"];$i<=100;$i++) {?>
						<option value="<?php echo $i."%"; ?>"><?php echo $i;?>%</option>
					<?php } ?>
				</select>
				</eq>
				<input type="hidden" name="daohuoshuliang[]">
				</eq>
				
				<eq name="schedule.subworktype" value="到货情况">
				<input value="{$schedule[realcount]}" type="text" <eq name="_SESSION[app]" value="1">style="width:40px;font-size:10px;"</eq> style="position:relative;top:5px;height:25px;background:white;width:85px" name="daohuoshuliang[]" placeholder="到货数量">
				<input type="hidden" name="percent[]">
				</eq>
				</in>
				
				
				
				
				<in name="moduletitle" value="施工进度管理,主项进度管理">
				<neq name="_SESSION[app]" value="1">
				
				<select class="chosen-select" name="percent[]" id="percent{$key}" style="background-color:transparent;color:#777;margin-left:10px;border:0px;width:85px" placeholder="选择进度">
					<eq name="_SESSION[account]" value="admin">
					<?php for($i=0;$i<$schedule["percentdigit"];$i++) {?>
						<option value="<?php echo $i."%"; ?>"><?php echo $i;?>%</option>
					<?php } ?>
					</eq>
				
					<?php for($i=$schedule["percentdigit"];$i<=100;$i++) {?>
						<option <?php if($schedule["percent"]==($i."%")) echo "selected";?> value="<?php echo $i."%"; ?>"><?php echo $i;?>%</option>
					<?php } ?>
					
					
				</select>
				</neq>
				<eq name="_SESSION[app]" value="1">
				<select name="percent[]" id="percent{$key}" style="width:35px;border:1px solid #ccc;padding:0px;outline: 1px solid #ccc;height:23px" placeholder="选择进度">
					<eq name="_SESSION[account]" value="admin">
					<?php for($i=0;$i<$schedule["percentdigit"];$i++) {?>
						<option value="<?php echo $i."%"; ?>"><?php echo $i;?>%</option>
					<?php } ?>
					</eq>
					
					<?php for($i=$schedule["percentdigit"];$i<=100;$i++) {?>
						<option <?php if($schedule["percent"]==($i."%")) echo "selected";?> value="<?php echo $i."%"; ?>"><?php echo $i;?>%</option>
					<?php } ?>
				</select>
				</eq>
				</in>
				
				</td>
				
				
				
				
				
				<td class="normal" >
				<input value="" type="text" style="position:relative;top:5px;height:25px;background:white;width:40px" name="remark[]" placeholder="">
				</td>
				<td class="normal" >
				
				
				<?php foreach($schedule[photos] as $k => $photo){ if(!empty($photo)){?>
				<div id="<?php echo $photo;?>" style="line-height:20px">
				<a href="__URL__/filedown/filename/<?php echo $photo;?>/filerealname/<?php echo $schedule[photosrealname][$k];?>" style="color:blue">
				<?php echo $schedule[photosrealname][$k];?>
				</a> 
				<a href="javascript:deleteFile('<?php echo $photo;?>')" style="color:red">删除</a>
				</div>
				<?php }} ?>
				
				
				<neq name="_SESSION[app]" value="1">
				<input type="file" style="position:relative;border:0px;width:80px" name="file{$key}[]" id="upload{$key}" placeholder="" multiple onchange="getFile(value,{$key})">
				</neq>
				<eq name="_SESSION[app]" value="1">
				<input type="file" style="display:none" name="file{$key}[]" id="upload{$key}" placeholder="选择" multiple onchange="getFile(value,{$key})">
				<a type="button" class="btn btn-info btn-xs" onClick="clickFile({$key})">上传</a>
				</eq>
				<div id="doc{$key}"></div>
				<script>
					
					function getFile(value,key){
						mask.show();
						mui.showLoading("正在上传文件,请等待..","div")
						parent.document.getElementById("parentsubmit").style.display="none";
						$('#sgrzform').ajaxSubmit({
							dataType:'json',//服务器返回json格式数据
							type: "post",
							url: "__APP__/Sgrz/uploadfile/",
							data: $('#sgrzform').serialize(),
							error: function (data) {
							
								console.log(data);
								mask.close();
								mui.hideLoading();
								parent.document.getElementById("parentsubmit").style.display="";
								$("#upload"+key).val("");
								mui.alert('服务器连接超时，请稍后再试');
							},
							success: function (data) {
								mask.close();
								mui.hideLoading();
								parent.document.getElementById("parentsubmit").style.display="";
								var result = new Array();  
								result = eval(data);
								console.log(result);
								
								if(result['status']=="1")
								{
									mui.toast("上传成功");
									var filearray = eval(result['message']);
									console.log(filearray);
									// 获取文本框dom
									var doc = document.getElementById('doc'+key);
									// 获取上传控件dom
									var upload = document.getElementById('upload'+key);
									// 获取文件名
									var fileName = "";
									for(i = 0; i < upload.files.length; i++) {
										fileName = upload.files[i].name;
										
										div=document.createElement('div');
										div.id=filearray[i];
										div.style="line-height:20px";
										div.innerHTML='<a href="__URL__/filedown/filename/'+filearray[i]+'/filerealname/'+fileName+'" style="color:blue">'+fileName+'</a>'+' <a href="javascript:deleteFile('+"'"+filearray[i]+"'"+')" style="color:red">删除</a>';
										document.getElementById('doc'+key).appendChild(div);	
										sortnum++;
									}
								}else{
									mui.alert(result['message']);
								}
								$("#upload"+key).val("");
							}
							
						});
						
					}
					
					function deleteFile(filenewname)
					{
						mask.show();
						mui.showLoading("正在删除文件,请等待..","div")
						$('#sgrzform').ajaxSubmit({
							dataType:'json',//服务器返回json格式数据
							type: "post",
							url: "__APP__/Sgrz/deleteFile/filenewname/"+filenewname,
							error: function (data) {
								console.log(data);
								mask.close();
								mui.hideLoading();
								parent.document.getElementById("parentsubmit").style.display="";
								mui.alert('服务器连接超时，请稍后再试');  
							},
							success: function (data) {
								mask.close();
								mui.hideLoading();
								parent.document.getElementById("parentsubmit").style.display="";
								var result = new Array();  
								result = eval(data);
								
								if(result['status']=="1")
								{
									document.getElementById(result['message']).style.display="none";
									mui.toast("删除成功");
								}else{
									mui.alert(result['message']);
								}
							}
						});
					
					}
				</script>

				</td>
				<in name="moduletitle" value="采购进度管理,开发进度管理">
				<!-- <td class="normal" ><input type="text" style="position:relative;top:5px;height:25px;background:white;width:38px" name="keeper[]" value="{$schedule[keeper]}" placeholder=""></td> -->
				<td class="normal" >
				<neq name="_SESSION[app]" value="1">
				<select class="chosen-select" name="keeper[]" style="background-color:transparent;color:#777;margin-left:10px;border:0px;width:88px" placeholder="">
					<option value="">选择</option>
					<volist name="users" id="user">
					<option value="{$user.nickname}" <eq name="schedule.keeper" value="$user.nickname">selected</eq>>{$user.nickname}</option>
					</volist>
				</select>
				</neq>
				<eq name="_SESSION[app]" value="1">
				<select class="chosen-select" name="keeper[]" style="width:35px;border:1px solid #ccc;padding:0px;outline: 1px solid #ccc;height:23px" placeholder="">
					<option value="">选择</option>
					<volist name="users" id="user">
					<option value="{$user.nickname}" <eq name="schedule.keeper" value="$user.nickname">selected</eq>>{$user.nickname}</option>
					</volist>
				</select>
				</eq>
				</td>
				</in>
			</tr>
			</volist>
			
		</table>
		</div>
	</td>
	</tr>
	
</table> 
<input id="plmid" value="{$plmid}" name="plmid" style="display:none">
</form>
<div class="modal-footer" style="background-color:white;display:none">
	<div id="submit_div" class="mui-content-padded" style="margin-left: 15px;margin-right: 15px;">
	<button id='submit' style="background-color: #f89b48;border:0px;border-radius: 5px;height: 40px;line-height:20px;text-align: center;color:white;font-size:14px;width:100%">
		确定上传
	</button>
	</div>
</div>	
	
	
</div> 




<!-- 微信 JS-SDK 如果不需要兼容小程序，则无需引用此 JS 文件。 -->  
<script type="text/javascript" src="//res.wx.qq.com/open/js/jweixin-1.4.0.js"></script>  
<!-- uni 的 SDK，必须引用。 -->  
<script type="text/javascript" src="//js.cdn.aliyun.dcloud.net.cn/dev/uni-app/uni.webview.0.1.52.js"></script>
<script src="__PUBLIC__/appsource/js/mui.min.js"></script> 
<script src="__PUBLIC__/appsource/js/mui.zoom.js"></script>
<script src="__PUBLIC__/appsource/js/mui.previewimage.js"></script>
<script src="__PUBLIC__/appsource/js/mui.picker.js"></script>
<script src="__PUBLIC__/appsource/js/mui.poppicker.js"></script>
<script src="__PUBLIC__/appsource/js/jquery-3.2.1.min.js"></script>
<!-- Chosen -->
<script src="js/plugins/chosen/chosen.jquery.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/jquery-form.js" ></script>

<link href="__PUBLIC__/appsource/muishowloading/showloading.css" rel="stylesheet">
<script src="__PUBLIC__/appsource/muishowloading/showloading.js"></script>

<script type="text/javascript">
	var imgList = [];
	var imgNameList = [];
	mui.init();
	var account = "{$_SESSION[account]}";
	var mask = mui.createMask();
	var currentindex=1;
	var plmid="{$plmid}";
	var moduletitle="{$moduletitle}";
	
	document.getElementById("submit").addEventListener("click",function(){
		/*
		var plmid=document.getElementById("plmid").value;
		if((plmid==null)||(plmid==""))
		{
			mask.close();
			mui.alert("请选择项目");
			return;
		}
		*/
		
		mask.show();
		//mui.toast("提交中...");
		mui.showLoading("正在上传,请等待..","div")
		/*
		$('#sgrzform').ajaxSubmit("__APP__/Sgrz/dailysubmit/",{
			dataType:'json',//服务器返回json格式数据
			data:$('#sgrzform').serialize(),
			type:'post',//HTTP请求类型
			success:function(data){
				mask.close();
				var result = new Array();  
				result = eval(data);
				console.log(data);
				if(result['message']=="操作成功")
				{
					mui.toast("操作成功");
					parent.location.href=parent.location.href;
				}else{
					mui.alert(result['message']);
				}
			},
			error: function(xhr, type, errorThrown) {  
				mask.close();
				mui.alert('服务器连接超时，请稍后再试');  
			}
		});*/
		parent.document.getElementById("parentsubmit").style.display="none";
		$('#sgrzform').ajaxSubmit({
			dataType:'json',//服务器返回json格式数据
            type: "post",
            url: "__APP__/Sgrz/dailysubmit/",
            data: $('#sgrzform').serialize(),
            error: function (data) {
				console.log(data);
				mask.close();
				mui.hideLoading();
				parent.document.getElementById("parentsubmit").style.display="";
				mui.alert('服务器连接超时，请稍后再试');  
            },
            success: function (data) {
				mask.close();
				mui.hideLoading();
				parent.document.getElementById("parentsubmit").style.display="";
				var result = new Array();  
				result = eval(data);
				if(result['message']=="操作成功")
				{
					mui.toast("操作成功");
					//location.href=location.href;
					setTimeout("parentrefresh()",500);
					
				}else{
					mui.alert(result['message']);
				}
            }
        });
	});
	
	function parentrefresh()
	{
		parent.location.href=parent.location.href;
	}
	
	
	
	function clickFile(key) {
		var userAgent = navigator.userAgent;
	　　var isiOS = !!userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);
		document.getElementById("upload"+key).click();
		if(isiOS)
		document.getElementById("upload"+key).click();
	}
	function setLocation(plmid) {
		location.href="__URL__/piliangdailyadd2/moduletitle/{$moduletitle}/plmid/"+plmid;
	}			
	$(function() {
		//获取项目列表
		mui.ajax("__APP__/Bproject/plmlist/webid/dailyadd",{
				dataType:'json',//服务器返回json格式数据
				type:'post',//HTTP请求类型					
				headers:{'Content-Type':'application/json'},
				success:function(data){
					var list = new Array();  
					list = eval(data);
					var data=[];
					var selectindex;
					var store;
					for (var index in list){
						if(list[index] != null){
							var content = list[index];
							var body = {
								"value":list[index]['id'],
								"text":list[index]['title']
							};
							data.push(body);
						}
					}
					
					
					$("select[name='xuanzexiangmu']").empty();
					var code="<option value=''>选择项目</option>";
					for(var i=0;i<data.length;i++){
						if(plmid==data[i]['value'])
						{
							code+="<option selected value='"+data[i]['value']+"'>"+data[i]['text']+"</option>";
						}
						else{
							code+="<option value='"+data[i]['value']+"'>"+data[i]['text']+"</option>";
						}
					}
					$("select[name='xuanzexiangmu']").append(code);
					$("select[name='xuanzexiangmu']").trigger("chosen:updated");
					$("select[name='xuanzexiangmu']").chosen({search_contains:true});
					$("select[name='xuanzexiangmu']").change(function()
					{
						location.href="__URL__/piliangdailyadd2/moduletitle/{$moduletitle}/plmid/"+this.value;
					});
					
					
					 
                        
					if(plmid=="")
					{	
						var plmbox="";
						for(var i=0;i<data.length;i++){
							plmbox+='<tr>\
									<td>'+data[i]["text"]+'</td>\
									<td>'+list[i]["design_status"]+'</td>\
									<td>'+list[i]["worktype_status"]+'</td>\
									<td>'+list[i]["plan_status"]+'</td>\
									<td>\
									<a href="javascript:setLocation('+data[i]["value"]+')" class="btn btn-info btn-xs">选择项目</a>\
									</td>\
								</tr>';
						}	
						document.getElementById("plmbox").innerHTML=plmbox;
					}
				},
			});
		$("select[name='percent[]']").trigger("chosen:updated");
		$("select[name='percent[]']").chosen({search_contains:true});
		
		$("select[name='keeper[]']").trigger("chosen:updated");
		$("select[name='keeper[]']").chosen({search_contains:true});
	})
</script> 
<script type="text/javascript" src="__PUBLIC__/appsource/js/immersed.js" ></script>
</body>
</html>