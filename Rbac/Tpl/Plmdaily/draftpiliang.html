	<link rel="shortcut icon" href="favicon.ico"> <link href="css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="css/font-awesome.css?v=4.4.0" rel="stylesheet">

    <!-- Data Tables -->
    <link href="css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">
    <link href="css/plugins/chosen/chosen.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css?v=4.1.0" rel="stylesheet">
	<link rel="stylesheet" href="css/main.css">
	


	<form id="format1" method="post" action="__URL__/insertpiliang" enctype="multipart/form-data" class="form-horizontal">    
		<div class="modal-body" style="padding:0px;margin:0px">
			<div class="form-group">
				<div class="col-sm-10" style="margin-bottom: 20px;">
					<label class="col-sm-2 control-label">项目：</label>
					<div class="col-sm-4">
					    <select class="form-control chosen-select" data-placeholder="选择项目" name="plmid[]" multiple style="width:930px">
							<volist name="citiesprojects" id="cityvo">
							<optgroup label="{$cityvo.city}">
							<volist name="cityvo.projects" id="projectvo">
							<option id="opt" value="{$projectvo.id}">{$projectvo.title}</option>
							</volist>
							</optgroup>
							</volist>
						</select>
					</div>
				</div>
				<div class="col-sm-10">
					<label class="col-sm-2 control-label">付款项：</label>
					<div class="col-sm-4">
					   <select name="classify" data-placeholder="选择预付款项" class="chosen-select" style="width:330px;" tabindex="4">
							<option value="">--请选择预付款项--</option>
							<volist name="classify" id="classifylist">
								<option value="{$classifylist.name}" hassubinfo="true">{$classifylist.name}</option>
							</volist>
						</select>
					</div>
					<label class="col-sm-2 control-label">供应商：</label>
					<div class="col-sm-4">
					    <select name="supplier" data-placeholder="选择供应商"  style="width:330px;" class="form-control">
							<option value="" id="opt2">--请选择供应商--</option>
						</select>
					</div>
				</div>
			</div>
			<div class="">
				<a onclick="fnClickAddRow();" href="javascript:void(0);" class="btn btn-primary ">添加行</a>
			</div>
			<div style="height:300px;overflow-y:auto;overflow-x:hidden;">
			<table class="table table-striped table-bordered table-hover " id="editable">
				<thead>
					<tr>
						<th width="3%">序号</th>
						<th width="6%">付款时间节点</th>
						<th width="6%">金额</th>
						<th width="6%">备注</th>
						<th width="5%">操作</th>
					</tr>
				</thead>
				<tbody>
					<tr id="table-row-0">
						<td><div style="width:10px;height:10px;border-radius:20px;background-color:#000;"></div></td>
						<td><input placeholder="请选择时间节点" class="form-control layer-date" name="time[]" size="40%" value="" onclick="laydate({istime: true, format: 'YYYY-MM-DD'})" style="float:left;margin-right:10px"></td> 
						</td>
						<td><input type="text" placeholder="价格"  class="form-control price" size="30%" name="price[]" onblur="jisuan()"></td>  
						<td><textarea id="" cols="30" rows="1" class="form-control" name="remarks[]"></textarea>
							<!-- <input type="text" placeholder="备注"  class="form-control" size="40%" name="remarks[]"> -->
						</td>         
						<td>						
						<a class="btn btn-danger btn-xs delete" href="javascript:void(0);">删除</a>
						</td>
					</tr>
				</tbody>
			</table>
			</div>
		</div>
		<div class="modal-footer">
			<span style="float:left">材料总价：</span><input type="text" readonly placeholder="总价自动计算" class="form-control" style="width:150px;float:left;position:relative;top:-7px" name="total" id="price"><span style="float:left;width:20px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
			<span style="float:left">保证金：</span><input type="text"  placeholder="保证金" class="form-control" style="width:150px;float:left;position:relative;top:-7px;border-color: green;" name="baozheng"><span style="float:left;width:20px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
			<span style="float:left">付款事由：</span><input type="text" placeholder="" class="form-control" style="width:200px;float:left;position:relative;top:-7px;border-color: green;" name="because" id="because">
			<span style="float:left;width:20px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
			<span style="float:left">备注：</span><input type="text" placeholder="" class="form-control" style="width:200px;float:left;position:relative;top:-7px;border-color: green;" name="remark" id="remark">
			<a href="#" onclick="changeout()" class="btn btn-primary">确认订单</a>
			<button id="btnclick" class="btn btn-primary hidden"></button>
		</div>
	</form>
	<div id="modal" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
	  <div class="modal-dialog" style="width:850px;height:600px">
		<div class="modal-content">
		   <div class="modal-header">  
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">  
                    <span aria-hidden="true">×</span>  
                </button>  
                <h4 class="modal-title" id="myModalLabel">Modal title</h4>  
            </div>  
            <div class="modal-body">  
                <p>One fine body…</p>  
            </div>  
            <div class="modal-footer">  
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>  
                <button type="button" class="btn btn-primary">Save</button>  
            </div>  
		</div>
	  </div>
	</div>
    <script src="js/jquery.min.js?v=2.1.4"></script>	
    <!-- Chosen -->
    <script src="js/plugins/chosen/chosen.jquery.js"></script>
    <script src="js/demo/form-advanced-demo.js"></script>
	<!-- jQuery Validation plugin javascript-->
    <script src="js/plugins/validate/jquery.validate.min.js"></script>
    <script src="js/plugins/validate/messages_zh.min.js"></script>

    <script src="js/demo/form-validate-demo.js"></script>
	<script>
		var table=$('#editable').dataTable(
		{
		   iDisplayLength : 10000
		}
		);
    </script>
    <script>

        function fnClickAddRow() {
        	var flag=0;
        	$('input[name="time[]"]').each(function(i){
        		if($(this).val()==''){
        			alert('已经有未设置时间的节点.');
        			flag=1;
        		}
        	});
        	if(flag==0){
        		$('#editable').dataTable().fnAddData([
	            	'<div style="width:10px;height:10px;border-radius:20px;background-color:#000;"></div>',
				    '<input type="text" placeholder="请选择时间节点" class="form-control layer-date" name="time[]" value="" style="width:250px;float:left;margin-right:10px"/>',
					'<input type="text" placeholder="价格" class="form-control price" size="30%" name="price[]" onblur="jisuan()">',
					'<textarea id="" cols="30" rows="1" class="form-control" name="remarks[]"></textarea>',
					'<a class="btn btn-danger btn-xs delete" href="javascript:void(0);">删除</a>'
					]);
				$('.layer-date').click(function(){
					laydate({istime: true, format: 'YYYY-MM-DD'});
				});
				$('.delete').on('click', function(e) {
					var table = $('#editable').DataTable();
					table.row($(this).parents('tr')).remove().draw();
					jisuan();
				});
				$('select').attr('class','form-control');
        	}
	            
        }
    </script>
    <script>
		function jisuan(){
			var total=parseFloat(0);
			total=parseFloat(total);
			$('.price').each(function(i){
				total=parseFloat(total+parseFloat($(this).val()));
			});
			if(isNaN(total)){
				total=0;
			}
			$('#price').val(total);
		}
		
	
    </script>
   
	<script>
	    $("select[name='city']").change(function(){
		$("#opt").nextAll().remove();
		var city=$(this).val();
		var aj = $.ajax({
				url:'__URL__/ajaxcity',
				data:{  
					city : city
				},
				type:'post',  
				cache:false,  
				dataType:'json',  
				success:function(data) {
					console.log(data);
					if(data!=null){
						var code="";
						for(var i=0;i<data.length;i++){
						code+="<option value='"+data[i]['id']+"'>"+data[i]['title']+"</option>";
						}
						$("select[name='plmid']").append(code);
					}					
					
				}  
			});
		
		})
	
	</script>
	<script>
	 function changeout(){
	 	var supplier=$('select[name="supplier"]').val();
	 	var city=$('select[name="city"]').val();
	 	var plm=$('select[name="plmid"]').val();
	 	var name=$('select[name="classify"]').val();
	 	var count=0;
	 	$('input[name="time[]"]').each(function(){
	 		if($(this).val()==''){
	 			count++;
	 		}
	 	});
	 	if(count>1){
	 		alert('时间节点只能留一个空白.');
	 	}else{
	 		if(supplier==''){
		 		alert('请选择供应商.');
		 	}else if(city==''){
		 		alert('请选择城市.');
		 	}else if(plm==''){
		 		alert('请选择项目.');
		 	}else if(name==''){
		 		alert('请选择预付款项.');
		 	}else{
		 		$("#btnclick").click();
		 	}
	 	}
		 	
	 }
	</script>
	<script>
		$('select[name="classify"]').change(function(){
			$("#opt2").nextAll().remove();
			var classify=$(this).val();
			var ajax=$.ajax({
				url:'__URL__/ajaxclassify',
				data:{classify:classify},
				type:'post',
				cache:false,
				dataType:'json',
				success:function(data){
						console.log(data);
						var code="";
						for(var i=0;i<data.length;i++){
						code+="<option value='"+data[i]['supplier']+"'>"+data[i]['supplier']+"</option>";
						}
						$("select[name='supplier']").append(code);
		
				}
			});
		});

	</script>

    