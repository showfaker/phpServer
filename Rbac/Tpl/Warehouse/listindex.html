	<link rel="shortcut icon" href="favicon.ico"> <link href="css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="css/font-awesome.css?v=4.4.0" rel="stylesheet">

    <!-- Data Tables -->
    <link href="css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">
    <link href="css/plugins/chosen/chosen.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css?v=4.1.0" rel="stylesheet">
	<link rel="stylesheet" href="css/main.css">
	


	<form id="format1" method="post" action="__URL__/insert" enctype="multipart/form-data" class="form-horizontal">    
		<div class="modal-body">		    
			<div class="form-group">
			    <div style="font-weight:bold;margin-left:80px">余料:</div>
				<div class="col-sm-10">
					<label class="col-sm-2 control-label">城市：</label>
					<div class="col-sm-4">
					    <select name="city" data-placeholder="选择城市" class="chosen-select" style="width:230px;" tabindex="2">
							<option value="">请选择城市</option>
							<volist name="cities" id="citylist">
							<option value="{$citylist.city}" hassubinfo="true">{$citylist.city}</option>
							</volist>
						</select>
					</div>
					<label class="col-sm-2 control-label">项目：</label>
					<div class="col-sm-4">
					    <select class="form-control" name="plmid" style="width:230px">
							<option id="opt" value="">请选择项目</option>
						</select>
					</div>
				</div>
			</div>
		
			<div class="form-group" id="zcxx">
			    <div style="font-weight:bold;margin-left:80px">转场:</div>
				<div class="col-sm-10">
					<label class="col-sm-2 control-label">城市：</label>
					<div class="col-sm-4">
					    <select name="city1" data-placeholder="选择城市" class="chosen-select" style="width:230px;" tabindex="2">
							<option value="">请选择城市</option>
							<volist name="cities" id="citylist">
							<option value="{$citylist.city}" hassubinfo="true">{$citylist.city}</option>
							</volist>
						</select>
					</div>
					<label class="col-sm-2 control-label">项目：</label>
					<div class="col-sm-4">
					    <select class="form-control" name="plmid1" style="width:230px">
							<option id="opt1" value="">请选择项目</option>
						</select>
					</div>
				</div>
			</div>
			<div class="">
				<a onclick="fnClickAddRow();" href="javascript:void(0);" class="btn btn-primary ">添加行</a>
			</div>
			<table class="table table-striped table-bordered table-hover " id="editable">
				<thead>
					<tr>
						<th width="10%">材料编号</th>
						<th width="10%">材料名称</th>
						<th width="6%">材料类别</th>
						<th width="6%">规格型号</th>
						<th width="6%">单位</th>
						<th width="10%">供应商</th>
						<th width="6%">价格</th>
						<th width="6%">数量</th>
						<th width="5%">操作</th>
					</tr>
				</thead>
				<tbody>					
					<tr id="table-row-0">
						<input type="hidden" name="mid[]" id="mid_0">
						<td><input type="text" placeholder="材料编号" class="form-control" size="10%" name="para1[]" id="para1_0">
							<a href="" onclick="find(this)" title="0" data-toggle="modal" data-target="#modal" data-backdrop="static"  target="dialog" class="btn btn-info btn-xs">查找</a>
						</td>
						
						<td><input type="text" placeholder="材料名称" class="form-control" size="10%" name="para2[]" id="para2_0"><a href="" onclick="find1(this)" title="0" data-toggle="modal" data-target="#modal" data-backdrop="static"  target="dialog" class="btn btn-info btn-xs">查找</a>
						</td>
						<td><input type="text" placeholder="材料类别" class="form-control" size="6%" name="para3[]" id="para3_0"></td>
						<td><input type="text" placeholder="规格型号" class="form-control" size="6%" name="para4[]" id="para4_0"></td>
						<td><input type="text" placeholder="单位" class="form-control" size="5%" name="para5[]" id="para5_0"></td>
						<td><input type="text" placeholder="供应商" class="form-control" size="10%" name="para6[]" id="para6_0"></td>
						<td><input type="text" placeholder="价格" class="form-control price" size="5%" name="para7[]" id="para7_0"></td>
						<td><input type="text" placeholder="数量" oninput="calcprice()" class="form-control count" size="5%" name="para8[]" id="para8_0"></td>                        
						<td>						
						<a class="btn btn-danger btn-xs delete" href="javascript:void(0);">删除</a>
						</td>				
					</tr>					
				</tbody>
			</table>
		</div>	
		<div class="modal-footer">
		
			<span style="float:left">材料总价：</span><input type="text" readonly placeholder="总价自动计算" class="form-control" style="width:150px;float:left;position:relative;top:-7px" name="price" id="price">
			
			<button class="btn btn-sm btn-primary pull-right m-t-n-xs" type="button" id="sub"><strong>提交采购单</strong>
			</button>
			
		</div>
	</form>
    <script src="js/jquery.min.js?v=2.1.4"></script>	
    <!-- Chosen -->
    <script src="js/plugins/chosen/chosen.jquery.js"></script>
    <script src="js/demo/form-advanced-demo.js"></script>
    <script>
		var currentrow=1;
        function fnClickAddRow() {
            $('#editable').dataTable().fnAddData([
				'<input type="hidden" name="mid[]" id="mid_'+currentrow+'"><input type="text" placeholder="材料编号" style="margin-right:4px" class="form-control" size="10%" name="para1[]" id="para1_'+currentrow+'"><a href="" onclick="find(this)" title="'+currentrow+'" data-toggle="modal" data-target="#modal" data-backdrop="static"  target="dialog" class="btn btn-info btn-xs">查找</a>',
				'<input type="text" placeholder="材料名称" class="form-control" size="10%" name="para2[]" id="para2_'+currentrow+'"><a href="" onclick="find1(this)" title="'+currentrow+'" data-toggle="modal" data-target="#modal" data-backdrop="static"  target="dialog" class="btn btn-info btn-xs">查找</a>',
                '<input type="text" placeholder="材料类别" class="form-control" size="6%" name="para3[]" id="para3_'+currentrow+'">',
                '<input type="text" placeholder="规格型号" class="form-control" size="6%" name="para4[]" id="para4_'+currentrow+'">',
                '<input type="text" placeholder="单位" class="form-control" size="5%" name="para5[]" id="para5_'+currentrow+'">',
                '<input type="text" placeholder="供应商" class="form-control" size="10%" name="para6[]" id="para6_'+currentrow+'">',
                '<input type="text" placeholder="价格" class="form-control price" size="5%" name="para7[]" id="para7_'+currentrow+'">',
				'<input type="text" placeholder="数量" oninput="calcprice()" class="form-control count" size="5%" name="para8[]" id="para8_'+currentrow+'">',
				'<a class="btn btn-danger btn-xs delete" href="javascript:void(0);">删除</a>'
				]);
			currentrow++;
			$('.delete').on('click', function(e) {
				var table = $('#editable').DataTable();
				table.row($(this).parents('tr')).remove().draw();
			});
        }
		function calcprice()
		{
			var sum=0;
			$(".count").each(function(){
				var t=$(this).val();
				var n=$(this).parent().parent().find(".price").val();
				var a=t*n;
				sum+=Number(a);
			})
			sum=sum.toFixed(2);
			document.getElementById("price").value=sum;
		}
    </script>

	<script>
	    $("#sub").click(function(){
           $("#format1").submit();
		})
	</script>

	<script>
	    $("select[name='city']").change(function(){
		$("#opt").nextAll().remove();
		var city=$(this).val();
		var aj = $.ajax({
				url:'__URL__/ajaxcity',
				data:{  
					city : city
				},
				type:'post',  
				cache:false,  
				dataType:'json',  
				success:function(data) {
					if(data!=null){
						var code="";
						for(var i=0;i<data.length;i++){
						code+="<option value='"+data[i]['id']+"'>"+data[i]['title']+"</option>";
						}
						$("select[name='plmid']").append(code);
					}					
					
				}  
			});
		
		})
	
	</script>
	<script>
	    $("select[name='city1']").change(function(){
		$("#opt1").nextAll().remove();
		var city=$(this).val();
		var aj = $.ajax({
				url:'__URL__/ajaxcity',
				data:{  
					city : city
				},
				type:'post',  
				cache:false,  
				dataType:'json',  
				success:function(data) {
					if(data!=null){
						var code="";
						for(var i=0;i<data.length;i++){
						code+="<option value='"+data[i]['id']+"'>"+data[i]['title']+"</option>";
						}
						$("select[name='plmid1']").append(code);
					}					
					
				}  
			});
		
		})
	
	</script>
	 <script>
        function find(e){
        var city=$("select[name='city']").val();
        // alert(supplier);
        var number=$(e).prev().val();
        if($('input[name="tj_id"]').val()>0){
        	var supplier=$("input[id='para6_0']").val();
        	$(e).attr("href","__URL__/choice/key/"+e.title+"/city/"+city+"/supplier/"+supplier+"/number/"+number);
        }else{
        	$(e).attr("href","__URL__/choice/key/"+e.title+"/city/"+city+"/number/"+number);
        }		
		 
		}
    	
	</script>
	<script>
        function find1(e){
        var city=$("select[name='city']").val();
        // var supplier=$("input[id='para6_0']").val();
        var name=$(e).prev().val();	
        // alert(name);	
		 if($('input[name="tj_id"]').val()>0){
        	var supplier=$("input[id='para6_0']").val();
        	$(e).attr("href","__URL__/choice/key/"+e.title+"/city/"+city+"/supplier/"+supplier+"/name/"+name);
        }else{
        	$(e).attr("href","__URL__/choice/key/"+e.title+"/city/"+city+"/name/"+name);
        }	 
		}
    	
	</script>
	