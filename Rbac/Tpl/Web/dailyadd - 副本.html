<!DOCTYPE html>
<html>
 <head> 
  <meta charset="utf-8" /> 
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" /> 
  <title>施工日志</title> 
  <link href="__PUBLIC__/appsource/css/mui.css" rel="stylesheet" /> 
  <script type="text/javascript" src="__PUBLIC__/appsource/js/common.js"></script>
  <link href="__PUBLIC__/appsource/css/mui.picker.css" rel="stylesheet" />
  <link href="__PUBLIC__/appsource/css/mui.poppicker.css" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" href="__PUBLIC__/appsource/css/mui.picker.min.css" />
  <style type="text/css">
            body {
                background-color: #efeff4;
            }
            .mui-content {} .mui-content a {
                color: #8F8F94;
            }
            .mui-content a.active {
                color: #007aff;
            }
            .mui-title {
                font-family: simhei;
            }
            .btn_1 {
                position: absolute;
                bottom: 100px;
                left: 10px;
                right: 10px;
            }
            .btn_2 {
                position: absolute;
                bottom: 20px;
                left: 10px;
                right: 10px;
            }
            .mui-btn-block {
                width: 90%;
                margin: 0 auto;
            }
            body {
                overflow: hidden;
            }
            .showimg {
                margin: 10px 10px auto 10px;
                float:left;
            }
            .add-tp{
                width: 46px;
                height: 46px;
                padding:2px;
                border:1px solid #ccc;
                border-radius:3px;
                float:left;
                margin-right:5px;
            }
            .add-tp img {
                width: 40px;
                height: 40px;
                float:left;
                border-radius:3px;
            }
        </style> 
        
	    <script type="text/javascript">
		var gentry=null,hl=null,le=null;
		var er=null,ep=null;
		var bUpdated=false; //用于兼容可能提前注入导致DOM未解析完更新的问题
		// H5 plus事件处理
		function plusReady(){
			// 获取音频目录对象
			plus.io.resolveLocalFileSystemURL('_doc/', function(entry){
				entry.getDirectory('audio', {create:true}, function(dir){
					gentry = dir;
					//updateHistory(); add by zcy
				}, function(e){
					outSet('Get directory "audio" failed: '+e.message);
				});
			}, function(e){
				outSet('Resolve "_doc/" failed: '+e.message);
			} );
		}
		if(window.plus){
			plusReady();
		}else{
			document.addEventListener('plusready', plusReady, false);
		}
		// DOMContentLoaded事件处理
		document.addEventListener('DOMContentLoaded', function(){
			// 获取DOM元素对象
			hl = document.getElementById('history');
			le = document.getElementById('empty');
			er = document.getElementById('record');
			rt = document.getElementById('rtime');
			ep = document.getElementById('play');
			pt = document.getElementById('ptime');
			pp = document.getElementById('progress')
			ps = document.getElementById('schedule');
			//updateHistory();苹果要删除这里
		},false);
		// 添加播放项
		function createItem( entry ) {
			var li = document.createElement('li');
			li.className = 'ditem';
			li.innerHTML = '<span class="iplay"><font class="aname"></font><br/><font class="ainf"></font></span>';
			li.setAttribute('onclick', 'playAudio(this)');
			hl.insertBefore(li, le.nextSibling);
			li.querySelector('.aname').innerText = entry.name;
			li.querySelector('.ainf').innerText = '...';
			li.entry = entry;
			updateInformation(li);
			// 设置空项不可见
			le.style.display = 'none';
		}
		// 开始录音
		var r=null,t=0,ri=null,rt=null;
		function startRecord(){
			cleanHistory();//add by zcy
			outSet('开始录音：');
			r = plus.audio.getRecorder();
			if ( r == null ) {
				console.log('录音对象未获取');
				return;
			}
			r.record({
				filename:'_doc/audio/',
				format:"amr" //iOS平台支持"wav"、"aac"、"amr"格式，默认为"wav"
				}, function(p){
				console.log('录音完成：'+p);
				plus.io.resolveLocalFileSystemURL(p, function(entry){
					createItem(entry);
					console.log("path:"+p);
           			Audio2dataURL(p);
				}, function(e){
					console.log('读取录音文件错误：'+e.message);
				});
			}, function(e){
				console.log('录音失败：'+e.message);
			} );
			er.style.display = 'block';
			t = 0;
			ri = setInterval(function(){
				t++;
				rt.innerText = timeToStr(t);
			}, 1000);
		}
		// 停止录音
		function stopRecord(){
			er.style.display = 'none';
			rt.innerText = '00:00:00';
			clearInterval(ri);
			ri = null;
			r.stop();
			w = null;
			r = null;
			t = 0;
		}
		// 清除历史记录
		function cleanHistory(){
			hl.innerHTML = '<li id="empty" class="ditem-empty">无记录</li>';
			le = document.getElementById('empty');
			// 删除音频文件
			outSet('清空录音历史记录：');
			gentry.removeRecursively(function(){
				// Success
				console.log('操作成功！');
			}, function(e){
				console.log('操作失败：'+e.message);
			});
		}
		// 获取录音历史列表
		function updateHistory(){
			if(bUpdated||!gentry||!document.body){//兼容可能提前注入导致DOM未解析完更新的问题
				return;
			}
		  	var reader = gentry.createReader();
		  	reader.readEntries(function(entries){
		  		for(var i in entries){
		  			if(entries[i].isFile){
		  				createItem(entries[i]);
		  			}
		  		}
		  	}, function(e){
		  		console.log('读取录音列表失败：'+e.message);
		  	});
			bUpdated = true;
		}
		// 获取录音文件信息
		function updateInformation(li){
			if(!li || !li.entry){
				return;
			}
			var entry = li.entry;
			entry.getMetadata(function(metadata){
				li.querySelector('.ainf').innerText = dateToStr(metadata.modificationTime);
			}, function(e){
				console.log('获取文件"'+entry.name+'"信息失败：'+e.message);
			} );
		}
		// 播放音频文件
		function playAudio(li){
			if(!li || !li.entry){
				ouSet('无效的音频文件');
				return;
			}
			outSet('播放音频文件：'+li.entry.name);
			startPlay('_doc/audio/'+li.entry.name);
		}
		// 播放文件相关对象
		var p=null,pt=null,pp=null,ps=null,pi=null;
		// 开始播放
		function startPlay(url){
			ep.style.display = 'block';
			var L = pp.clientWidth;
			p = plus.audio.createPlayer(url);
			p.play(function(){
				console.log('播放完成！');
				// 播放完成
				pt.innerText = timeToStr(d)+'/'+timeToStr(d);
				ps.style.webkitTransition = 'all 0.3s linear';
				ps.style.width = L+'px';
				stopPlay();
			}, function(e){
				console.log('播放音频文件"'+url+'"失败：'+e.message);
			});
			// 获取总时长
			var d = p.getDuration();
			if(!d){
				pt.innerText = '00:00:00/'+timeToStr(d);
			}
			pi = setInterval(function(){
				if(!d){ // 兼容无法及时获取总时长的情况
					d = p.getDuration();
				}
				var c = p.getPosition();
				if(!c){  // 兼容无法及时获取当前播放位置的情况
					return;
				}
				pt.innerText = timeToStr(c)+'/'+timeToStr(d);
				var pct = Math.round(L*c/d);
				if(pct < 8){
					pct = 8;
				}
				ps.style.width = pct+'px';
			}, 1000);
		}
		// 停止播放
		function stopPlay(){
			clearInterval(pi);
			pi=null;
			setTimeout(resetPlay, 500);
			// 操作播放对象
			if(p){
				p.stop();
				p=null;
			}
		}
		// 重置播放页面内容
		function resetPlay(){
			ep.style.display = 'none';
			ps.style.width = '8px';
			ps.style.webkitTransition = 'all 1s linear';
			pt.innerText = '00:00:00/00:00:00';	
		}
		// 重写关闭
		var _back=window.back;
		function resetback(){
			// 停止播放
			if(ep.style.display == 'block'){
				stopPlay();
			}else if(er.style.display == 'block'){
				stopRecord();
			}else{
				_back();
			}
		}
		window.back=resetback;
		
		function Audio2dataURL (path) {
		    plus.io.resolveLocalFileSystemURL(path, function(entry){
		        entry.file(function(file){
		            var reader = new plus.io.FileReader();
		            reader.onloadend = function (e) {
		                document.getElementById("audiobox").value=e.target.result;
		            };
		            reader.readAsDataURL(file);
		        },function(e){
		            mui.toast("读写出现异常: " + e.message );
		        })
		    })
		}
		
		</script>
		<link rel="stylesheet" href="__PUBLIC__/appsource/css/common.css" type="text/css" charset="utf-8"/>
		<style type="text/css">
		.rp {
			width: 100%;
			height: 100%;
			display: none;
			text-align: center;
			position: fixed;
			top: 0;
			background: rgba(0,0,0,0.8);
			z-index: 9999;
			overflow: hidden;
		}
		.aname {
			font-size: 16px;
		}
		.ainf {
			font-size: 12px;
		}
		.rtime {
			font-size: 22px;
			color: #FF0000;
		}
		.ptime {
			margin-top: 40%;
			font-size: 22px;
			color: #FFFFFF;
		}
		.rprogress {
			background: url(../img/arecord.png) no-repeat center center;
			background-size: 32px 32px;
		}
		.rschedule {
		    background-color: rgba(0,0,0,0);
		    border: 5px solid rgba(0,183,229,0.9);
		    opacity: .9;
		    border-left: 5px solid rgba(0,0,0,0);
		    border-right: 5px solid rgba(0,0,0,0);
		    border-radius: 50px;
		    box-shadow: 0 0 15px #2187e7;
		    width: 36px;
		    height: 36px;
		    margin: 0 auto;
		    -webkit-animation: spin 1s infinite linear;
		    animation: spin 1s infinite linear;
		}
		@-webkit-keyframes spin {
		    0% {
		        -webkit-transform: rotate(0deg);
		    }
		    100% {
		        -webkit-transform: rotate(360deg);
		    }
		}
		@keyframes spin {
		    0% {
		        transform: rotate(0deg);
		    }
		    100% {
		        transform: rotate(360deg);
		    }
		}
		.progress {
		  width: 90%;
		  background-color: #666;
		  margin: 0 5%;
		  border: 1px solid #222;
		  -webkit-border-radius: 5px;
		  border-radius: 5px;
		}
		.schedule {
		  width: 8px;
		  height: 8px;
		  margin: 1px 0;
		  background-color: #FFCC33;
		  -webkit-border-radius: 4px;
		  border-radius: 4px;
		  -webkit-transition: all 1s linear;
		  transition: all 1s linear;
		}
		.stop {
			width: 72px;
			height: 72px;
			background: url(../../images/icons/astop.png) center center;
			background-size: 72px 72px;
			margin: auto;
			-webkit-border-radius: 72px;
			border-radius: 72px;
		}
		.stop:active{
		  	-webkit-box-shadow: 0 3px 8px rgba(0, 0, 0, 0.5) inset;
			box-shadow: 0 3px 8px rgba(0, 0, 0, 0.5) inset;
		}
		.iplay {
			display: block;
			background: no-repeat right center url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABYCAYAAAADWlKCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAKwwAACsMBNCkkqwAAABZ0RVh0Q3JlYXRpb24gVGltZQAwOS8xMi8xM5w+I3MAAAAcdEVYdFNvZnR3YXJlAEFkb2JlIEZpcmV3b3JrcyBDUzVxteM2AAAD9UlEQVR4nO2b3XETMRRGDwzvoYOkg5hRAVkqiKmAdIA7wHSQVECoALsC1gXciV0BTge4gvCwgnHk9d/+WF8m97ztxrlXs8fS1Urym6enJxwd3uZugPMcFyKGCxHDhYjhQsRwIWK4EDFciBguRAwXIoYLEcOFiOFCxHAhYrgQMVyIGC5EDBcihgsRw4WI4ULEcCFiuBAx3uVuwDGY2XtgCBTAALjc8tEFMAdKYBJC+HOK9nXBm5dwUM7MCmAEXDcMMQVuQwhlV23qC2khZjYAboGrjkLOgFEIYd5RvM6RrSFmdgs80J0MYqyHGFsSuR4S60TJ9vrwCEziZ+YhhGXy/xdU9aWgqjfnW+IsgEKtvkgJiUPUPfUyZsD42DoQ68+Y+p62AG6UhjAZITt6xopq3L9vGf+Gqh6dJX+S6ilKNaRkU8YCGLSVARBjDGLMdS5jbgkkhMQiWyejSGtEG2KsghopKoU++5AV68ZDcrvXYWTH8Pghdz1R6CHpN3MFDPsc02PsYcy1qy0nJ6uQOANKZz+jfcOUmd3H6W1jYo5RcvsqtikbuXtI+kBmBxbwz8DczMZtksdcsz1tOinZhMRxPF2bGh8R4gz4amZLMxu2aEqa8zq2LQs5e0j6EB8bLv6dAz/NrGwyjMWcj3vadjJyCimS60nLeFfAbzO7bfANT3MXLdvSmJxCBsl12VHcL8AyvpkfSpo7bdvJyCkkfQfocv5/Bnw3s/mBs6Y097aFzd7JPcv6T5dv5GtcAr/2TZN7yt0IGSE908k0+RS8FiEvhhd1yKEFUw5YAVBApoe0XQrZwgL4GEIY7pLRU+5G5OwhC57PZgbAsqPYK6rdxUMXC9Npbro8fzJy9pB0qll0FPcOuDhCRl3ubEvwOYWUyXXb5YoZ1X7GqMHSfZq7bNmWxuQUki5XnDdc+n4EPoUQiiabSzFnejKl7TJOY7IJid/iaXJ7fESIFfCNas+9zQNMc05zHnjIPctKx/mrA9egflCJGLd5eDFXukGWdddQYU+95PlDWVE97GXPeS+oivf6saBZCKHoM+8+cvcQ2NyhOwMmfW4SxdgTNs9oZd0tBAEhsRDfJbcvgbIPKTtOnNzlPnECAkPWP8xsTv3ZrJ1v2UfmuKDqGRt5QgjZ9kDWyd5D1iioP1U4P3KzqZYYY5v0om38rpDpIeCHrUFMCPjPEeSE/COetf3SU/i7EEL2GVUdSjXkGfGBfWDzIFsb/q93dRizU2R7yDr+o09R/GfRzsmRrSGvFRcihgsRw4WI4ULEcCFiuBAxXIgYLkQMFyKGCxHDhYjhQsRwIWK4EDFciBguRAwXIoYLEcOFiOFCxHAhYrgQMf4CVuqCm+17t3sAAAAASUVORK5CYII=);
			background-size: 50px 44px;
			-ms-touch-action: auto;
		}
		</style>
 </head>
 <body> 
  <div class="mui-content mui-scroll mui-scroll-wrapper" style="overflow-y:scroll"> 
		<div style="height:auto"> 
  		<ul class="mui-table-view" style="margin-top:0px">
			<li class="mui-table-view-cell">
				<a id="xuanzexiangmu" class="mui-navigate-right">选择项目 <input name="xuanzexiangmu" readonly style="background-color:transparent;color:#777;margin-left:10px;border:0px;width:70%" placeholder="点击选择"></a>
			</li>
		</ul>
		<ul class="mui-table-view" style="border-top:1px solid #eee">
			<li class="mui-table-view-cell">
				<a id="xuanzegongxu" class="mui-navigate-right">选择节点 <input name="xuanzegongxu" readonly style="background-color:transparent;color:#777;margin-left:10px;border:0px;width:70%" placeholder="点击选择"></a>
			</li>
		</ul>
		<ul class="mui-table-view" style="border-top:1px solid #eee">
			<li class="mui-table-view-cell">
				<a id="benriyingdang">本日应当完成量 <input name="benriyingdang" readonly style="background-color:transparent;color:#777;margin-left:10px;border:0px;width:60%"></a>
			</li>
		</ul>
		<ul class="mui-table-view" style="border-top:1px solid #eee">
			<li class="mui-table-view-cell">
				<a id="wanchengchengdu" class="mui-navigate-right">实际现场完成量 <input name="wanchengchengdu" readonly style="background-color:transparent;color:#777;margin-left:10px;border:0px;width:60%" placeholder="点击选择"></a>
			</li>
		</ul>
		
		<ul class="mui-table-view" style="border-top:1px solid #eee;display:none" id="gx1">
			<li class="mui-table-view-cell">
				<a id="xuanzegongxu1" class="mui-navigate-right">选择节点 <input name="xuanzegongxu1" readonly style="background-color:transparent;color:#777;margin-left:10px;border:0px;width:70%" placeholder="点击选择"></a>
			</li>
		</ul>
		<ul class="mui-table-view" style="border-top:1px solid #eee;display:none" id="yd1">
			<li class="mui-table-view-cell">
				<a id="benriyingdang1">本日应当完成量 <input name="benriyingdang1" readonly style="background-color:transparent;color:#777;margin-left:10px;border:0px;"></a>
			</li>
		</ul>
		<ul class="mui-table-view" style="border-top:1px solid #eee;display:none" id="wc1">
			<li class="mui-table-view-cell">
				<a id="wanchengchengdu1" class="mui-navigate-right">实际现场完成量 <input name="wanchengchengdu1" readonly style="background-color:transparent;color:#777;margin-left:10px;border:0px;" placeholder="点击选择"></a>
			</li>
		</ul>
		<ul class="mui-table-view" style="border-top:1px solid #eee;display:none" id="gx2">
			<li class="mui-table-view-cell">
				<a id="xuanzegongxu2" class="mui-navigate-right">选择节点 <input name="xuanzegongxu2" readonly style="background-color:transparent;color:#777;margin-left:10px;border:0px;width:70%" placeholder="点击选择"></a>
			</li>
		</ul>
		<ul class="mui-table-view" style="border-top:1px solid #eee;display:none" id="yd2">
			<li class="mui-table-view-cell">
				<a id="benriyingdang2">本日应当完成量 <input name="benriyingdang2" readonly style="background-color:transparent;color:#777;margin-left:10px;border:0px;"></a>
			</li>
		</ul>
		<ul class="mui-table-view" style="border-top:1px solid #eee;display:none" id="wc2">
			<li class="mui-table-view-cell">
				<a id="wanchengchengdu2" class="mui-navigate-right">实际现场完成量 <input name="wanchengchengdu2" readonly style="background-color:transparent;color:#777;margin-left:10px;border:0px;" placeholder="点击选择"></a>
			</li>
		</ul>
		<ul class="mui-table-view" style="border-top:1px solid #eee;display:none" id="gx3">
			<li class="mui-table-view-cell">
				<a id="xuanzegongxu3" class="mui-navigate-right">选择节点 <input name="xuanzegongxu3" readonly style="background-color:transparent;color:#777;margin-left:10px;border:0px;width:70%" placeholder="点击选择"></a>
			</li>
		</ul>
		<ul class="mui-table-view" style="border-top:1px solid #eee;display:none" id="yd3">
			<li class="mui-table-view-cell">
				<a id="benriyingdang3">本日应当完成量 <input name="benriyingdang3" readonly style="background-color:transparent;color:#777;margin-left:10px;border:0px;"></a>
			</li>
		</ul>
		<ul class="mui-table-view" style="border-top:1px solid #eee;display:none" id="wc3">
			<li class="mui-table-view-cell">
				<a id="wanchengchengdu3" class="mui-navigate-right">实际现场完成量 <input name="wanchengchengdu3" readonly style="background-color:transparent;color:#777;margin-left:10px;border:0px;" placeholder="点击选择"></a>
			</li>
		</ul>
		<ul class="mui-table-view" style="border-top:1px solid #eee;display:none" id="gx4">
			<li class="mui-table-view-cell">
				<a id="xuanzegongxu4" class="mui-navigate-right">选择节点 <input name="xuanzegongxu4" readonly style="background-color:transparent;color:#777;margin-left:10px;border:0px;width:70%" placeholder="点击选择"></a>
			</li>
		</ul>
		<ul class="mui-table-view" style="border-top:1px solid #eee;display:none" id="yd4">
			<li class="mui-table-view-cell">
				<a id="benriyingdang4">本日应当完成量 <input name="benriyingdang4" readonly style="background-color:transparent;color:#777;margin-left:10px;border:0px;"></a>
			</li>
		</ul>
		<ul class="mui-table-view" style="border-top:1px solid #eee;display:none" id="wc4">
			<li class="mui-table-view-cell">
				<a id="wanchengchengdu4" class="mui-navigate-right">实际现场完成量 <input name="wanchengchengdu4" readonly style="background-color:transparent;color:#777;margin-left:10px;border:0px;" placeholder="点击选择"></a>
			</li>
		</ul>
		
		<div style="height:6px"></div>
		<div style="text-align:right;padding-right:5px">
		<button type="button" class="mui-btn mui-btn-success mui-icon mui-icon-plus" id="add">添加</button>
		<button type="button" class="mui-btn mui-btn-danger mui-btn-outlined" id="delete">
		<span class="mui-icon mui-icon-trash"></span>删除</button>
		</div>
		
		<div style="height:6px"></div>
		<ul class="mui-table-view" onclick="document.getElementById('rizhi').focus()">
			<li class="mui-table-view-cell">
				<a id="mudigang">填写日志（如延期请填写延期原因）</a>
				<textarea name="rizhi" id="rizhi"  style="background-color:#f7f7f7;color:#777;border:0px;position:relative;top:10px;z-index:9999999"></textarea>
			</li>
		</ul>
		<div style="height:6px"></div>
		<ul class="mui-table-view">
			<li class="mui-table-view-cell">
				<a id="huowuleixing">拍照上传 </a> 
				<div class="showimg" id="images" style="float:left">
					<a class="mui-icon mui-icon-plusempty" onclick="change()" style="padding:10px;border:1px dashed #ccc;border-radius:3px;float:left;"></a>
  				</div> 
				
			</li>
		</ul>
		<div style="height:6px"></div>
		<ul class="mui-table-view" style="padding-bottom:1px;">
			
				<a id="huowuleixing" style="position:relative;top:5px;left:15px">语音说明 </a>
				<div style="width:100%;height:50px">
				<div class="button" onclick="startRecord()" style="width:42%;float:left">开始录音</div>
				<div class="button button-waring" onclick="cleanHistory()" style="width:42%;float:left">清空语音</div>
				</div>
				<ul id="history" class="dlist" style="text-align:left;">
					<li id="empty" class="ditem-empty">无记录</li>
				</ul>
				
				
				<div id="output" style="display:none">
					Audio用于管理音频设备，可调用麦克风录制音频文件，也可播放音频文件。
				</div>
							
				<div id="play" class="rp">
					<div id="ptime" class="ptime">00:00:00/00:00:00</div><br/>
					<div id="progress" class="progress"><div id="schedule" class="schedule"></div></div>
					<br/>
					<div class="stop" onclick="stopPlay(),outSet('停止播放！')"></div>
				</div>
				<div id="record" class="rp">
					<div style="width:100%;height:20%;"></div>
					<div class="rprogress"><div class="rschedule"></div></div>
					<br/>
					<div id="rtime" class="rtime">00:00:00</div><br/>
					<div class="stop" onclick="stopRecord()"></div>
				</div>
		</ul>
		<div style="height:6px"></div>
		<ul class="mui-table-view" style="margin-top:0px;position:relative;padding-top:6px;padding-bottom:10px">
 	    <div id="submit_div" class="mui-content-padded" style="margin-left: 15px;margin-right: 15px;">
			<div id='submit' style="background-color: #f89b48;border:0px;border-radius: 5px;height: 40px;line-height:40px;text-align: center;">
				<a style="font-size: 17px;color: #ffffff;">确定上传</a>
			</div>
		</div>
		</ul>
	</div> 
  </div> 
  <div id='userResult' style="display:none"></div>
  <input id='plmid' style="display:none">
  
  <input id='worktypeid' style="display:none">
  <input id='worktypeid1' style="display:none">
  <input id='worktypeid2' style="display:none">
  <input id='worktypeid3' style="display:none">
  <input id='worktypeid4' style="display:none">
  
  
  <textarea id='imagebox1' style="display:none"></textarea>
  <textarea id='imagebox2' style="display:none"></textarea>
  <textarea id='imagebox3' style="display:none"></textarea>
  <textarea id='imagebox4' style="display:none"></textarea>
  <textarea id='imagebox5' style="display:none"></textarea>
  <textarea id='imagebox6' style="display:none"></textarea>
  <textarea id='imagebox7' style="display:none"></textarea>
  <textarea id='imagebox8' style="display:none"></textarea>
  <textarea id='imagebox9' style="display:none"></textarea>
  <textarea id='imagebox10' style="display:none"></textarea>
  <input id='audiobox' style="display:none">
  <script src="__PUBLIC__/appsource/js/mui.min.js"></script> 
  <script src="__PUBLIC__/appsource/js/mui.zoom.js"></script>
  <script src="__PUBLIC__/appsource/js/mui.previewimage.js"></script>
  <script src="__PUBLIC__/appsource/js/jquery.js"></script>
  <script src="__PUBLIC__/appsource/js/mui.picker.js"></script>
  <script src="__PUBLIC__/appsource/js/mui.poppicker.js"></script>
  <script src="__PUBLIC__/appsource/js/jquery-3.2.1.min.js"></script>
  <script type="text/javascript">
        mui.init();
        var account = "{$account}";
        var mask = mui.createMask();
        var currentindex=1;
		var plmid="{$plmid}";
        document.getElementById("submit").addEventListener("tap",function(){
        	
        	var wt = plus.nativeUI.showWaiting();
			mask.show();
			
			var rizhi=$("#rizhi").val();
			var plmid=document.getElementById("plmid").value;
			var worktypeid=document.getElementById("worktypeid").value;
			var worktypeid1=document.getElementById("worktypeid1").value;
			var worktypeid2=document.getElementById("worktypeid2").value;
			var worktypeid3=document.getElementById("worktypeid3").value;
			var worktypeid4=document.getElementById("worktypeid4").value;
			if((plmid==null)||(plmid==""))
			{
				plus.nativeUI.closeWaiting();
				mask.close();
				mui.alert("请选择项目");
				return;
			}
			if((worktypeid==null)||(worktypeid==""))
			{
				plus.nativeUI.closeWaiting();
				mask.close();
				mui.alert("请选择节点");
				return;
			}
			if((rizhi==null)||(rizhi==""))
			{
				//plus.nativeUI.closeWaiting();
				//mask.close();
				//mui.alert("请填写日志");
				//return;
				rizhi="无";
			}
			var imagedata1=document.getElementById("imagebox1").value;
			var imagedata2=document.getElementById("imagebox2").value;
			var imagedata3=document.getElementById("imagebox3").value;
			var imagedata4=document.getElementById("imagebox4").value;
			var imagedata5=document.getElementById("imagebox5").value;
			var imagedata6=document.getElementById("imagebox6").value;
			var imagedata7=document.getElementById("imagebox7").value;
			var imagedata8=document.getElementById("imagebox8").value;
			var imagedata9=document.getElementById("imagebox9").value;
			var imagedata10=document.getElementById("imagebox10").value;
			var audiodata=document.getElementById("audiobox").value;
			var percent=document.getElementsByName("wanchengchengdu")[0].value;
			var percent1=document.getElementsByName("wanchengchengdu1")[0].value;
			var percent2=document.getElementsByName("wanchengchengdu2")[0].value;
			var percent3=document.getElementsByName("wanchengchengdu3")[0].value;
			var percent4=document.getElementsByName("wanchengchengdu4")[0].value;
			
			if((rizhi=="无")&&((audiodata=="")||(audiodata==null)))
			{
				plus.nativeUI.closeWaiting();
				mask.close();
				mui.alert("请填写日志或语音");
				return;
			}
			
			mui.ajax("http://projectnandian.jiuze9.com/projecttest/Rbac/index.php/App/dailysubmit/account/"+account+"/plmid/"+plmid+"/rizhi/"+rizhi+"/worktypeid/"+worktypeid+"/worktypeid1/"+worktypeid1+"/worktypeid2/"+worktypeid2+"/worktypeid3/"+worktypeid3+"/worktypeid4/"+worktypeid4,{
				dataType:'json',//服务器返回json格式数据
				data:{
					base641:imagedata1,
					base642:imagedata2,
					base643:imagedata3,
					base644:imagedata4,
					base645:imagedata5,
					base646:imagedata6,
					base647:imagedata7,
					base648:imagedata8,
					base649:imagedata9,
					base6410:imagedata10,
					audio:audiodata,
					percent:percent,
					percent1:percent1,
					percent2:percent2,
					percent3:percent3,
					percent4:percent4
				},
				type:'post',//HTTP请求类型
				success:function(data){
					plus.nativeUI.closeWaiting();
					mask.close();
					var result = new Array();  
					result = eval(data);
					mui.alert(result['result']);
					if(result['result']=="操作成功")
					{
						var page = plus.webview.getWebviewById('dailylistsub');
						mui.fire(page, 'getlist', {});
						mui.back();
					}
				},
			    error: function(xhr, type, errorThrown) {  
			    	plus.nativeUI.closeWaiting();
					mask.close();
			        mui.alert('服务器连接超时，请稍后再试');  
			    }
			});
		});
        $(function() {
        	console.log(123456)
        	document.getElementById('add').addEventListener('tap', function(event) {
        		if(currentindex==5)
				{
					mui.alert("不能再增加了");
					return;
				}
				document.getElementById('gx'+currentindex).style.display="block";
				document.getElementById('yd'+currentindex).style.display="block";
				document.getElementById('wc'+currentindex).style.display="block";
				
				currentindex++;
			}, false);
			document.getElementById('delete').addEventListener('tap', function(event) {
				if(currentindex==1)
				{
					mui.alert("不能再减少了");
					return;
				}
				document.getElementById('gx'+(currentindex-1)).style.display="none";
				document.getElementById('yd'+(currentindex-1)).style.display="none";
				document.getElementById('wc'+(currentindex-1)).style.display="none";
				
				document.getElementsByName("xuanzegongxu"+(currentindex-1))[0].value="";
				document.getElementsByName("benriyingdang"+(currentindex-1))[0].value="";
				document.getElementsByName("wanchengchengdu"+(currentindex-1))[0].value="";
				
				document.getElementById("worktypeid"+(currentindex-1)).value="";
				document.getElementsByName("xuanzegongxu"+(currentindex-1))[0].value="";
				
				currentindex--;
			}, false);
										
        	var userPicker2 = new mui.PopPicker();
        	var userPicker1 = new mui.PopPicker();
        	
        	var userPicker21 = new mui.PopPicker();
        	var userPicker11 = new mui.PopPicker();
        	var userPicker22 = new mui.PopPicker();
        	var userPicker12 = new mui.PopPicker();
        	var userPicker23 = new mui.PopPicker();
        	var userPicker13 = new mui.PopPicker();
        	var userPicker24 = new mui.PopPicker();
        	var userPicker14 = new mui.PopPicker();
        	//获取项目列表
        	mui.ajax("http://projectnandian.jiuze9.com/projecttest/Rbac/index.php/App/plmlist/webid/dailyadd/account/"+account,{
					dataType:'json',//服务器返回json格式数据
					type:'post',//HTTP请求类型					
					headers:{'Content-Type':'application/json'},
					success:function(data){
						var list = new Array();  
						list = eval(data);
						var data=[];
						var selectindex;
						var store;
						for (var index in list){
							if(list[index] != null){
								var content = list[index];
								var body = {
									"value":list[index]['id'],
									"text":list[index]['title']
								};
								data.push(body);
								
								
								
								
								
								if(list[index]['id']==plmid){
									
									document.getElementById("plmid").value=plmid;
									document.getElementsByName("xuanzexiangmu")[0].value=list[index]['title'];
									
									mui.ajax("http://projectnandian.jiuze9.com/projecttest/Rbac/index.php/App/worktypelist/account/"+account+"/plmid/"+plmid,{
										dataType:'json',//服务器返回json格式数据
										type:'post',//HTTP请求类型					
										headers:{'Content-Type':'application/json'},	              
										success:function(data){
											var list = new Array();  
											list = eval(data);
											
											var data2=[];
											for (var index in list){
												if(list[index] != null){
													var content = list[index];
													var body = {
														"value":list[index]['id'],
														"text":list[index]['title'],
														"planpercent":list[index]['planpercent'],
														"currentpercent":list[index]['currentpercent']
													};
													data2.push(body);
												}
											}
											
											document.getElementById("worktypeid").value=list[0]['id'];
											document.getElementsByName("xuanzegongxu")[0].value=list[0]['title'];
									    	document.getElementsByName("benriyingdang")[0].value=list[0]['planpercent'];
									    	document.getElementsByName("wanchengchengdu")[0].value=list[0]['currentpercent'];
									    	
											userPicker2.setData(data2);
											var showUserPickerButton2 = document.getElementById('xuanzegongxu');
											showUserPickerButton2.addEventListener('tap', function(event) {
												userPicker2.show(function(items) {
													var content=JSON.stringify(items[0]);
													var obj = eval('(' + content + ')');
													document.getElementById("worktypeid").value=obj.value;
													document.getElementsByName("xuanzegongxu")[0].value=obj.text;
													document.getElementsByName("benriyingdang")[0].value=obj.planpercent;
													document.getElementsByName("wanchengchengdu")[0].value=obj.currentpercent;
													
													
													var currentpercent=obj.currentpercent.replace("%","");
													if(currentpercent=="")currentpercent=0;
													var data1=[];
													for(var ii=currentpercent;ii<=100;ii++)
													{
														var body1 = {"value":ii+"%","text":ii+"%"};data1.push(body1);
													}
													userPicker1.setData(data1);
													
													
													
												});
											}, false);
											//节点1
											userPicker21.setData(data2);
											var showUserPickerButton21 = document.getElementById('xuanzegongxu1');
											showUserPickerButton21.addEventListener('tap', function(event) {
												userPicker21.show(function(items) {
													var content=JSON.stringify(items[0]);
													var obj = eval('(' + content + ')');
													document.getElementById("worktypeid1").value=obj.value;
													document.getElementsByName("xuanzegongxu1")[0].value=obj.text;
													document.getElementsByName("benriyingdang1")[0].value=obj.planpercent;
													document.getElementsByName("wanchengchengdu1")[0].value=obj.currentpercent;
													
													var currentpercent=obj.currentpercent.replace("%","");
													if(currentpercent=="")currentpercent=0;
													var data1=[];
													for(var ii=currentpercent;ii<=100;ii++)
													{
														var body1 = {"value":ii+"%","text":ii+"%"};data1.push(body1);
													}
													userPicker11.setData(data1);
											
												});
											}, false);
											//节点2
											userPicker22.setData(data2);
											var showUserPickerButton22 = document.getElementById('xuanzegongxu2');
											showUserPickerButton22.addEventListener('tap', function(event) {
												userPicker22.show(function(items) {
													var content=JSON.stringify(items[0]);
													var obj = eval('(' + content + ')');
													document.getElementById("worktypeid2").value=obj.value;
													document.getElementsByName("xuanzegongxu2")[0].value=obj.text;
													document.getElementsByName("benriyingdang2")[0].value=obj.planpercent;
													document.getElementsByName("wanchengchengdu2")[0].value=obj.currentpercent;
													
													var currentpercent=obj.currentpercent.replace("%","");
													if(currentpercent=="")currentpercent=0;
													var data1=[];
													for(var ii=currentpercent;ii<=100;ii++)
													{
														var body1 = {"value":ii+"%","text":ii+"%"};data1.push(body1);
													}
													userPicker12.setData(data1);
												});
											}, false);
											//节点3
											userPicker23.setData(data2);
											var showUserPickerButton23 = document.getElementById('xuanzegongxu3');
											showUserPickerButton23.addEventListener('tap', function(event) {
												userPicker23.show(function(items) {
													var content=JSON.stringify(items[0]);
													var obj = eval('(' + content + ')');
													document.getElementById("worktypeid3").value=obj.value;
													document.getElementsByName("xuanzegongxu3")[0].value=obj.text;
													document.getElementsByName("benriyingdang3")[0].value=obj.planpercent;
													document.getElementsByName("wanchengchengdu3")[0].value=obj.currentpercent;
													
													var currentpercent=obj.currentpercent.replace("%","");
													if(currentpercent=="")currentpercent=0;
													var data1=[];
													for(var ii=currentpercent;ii<=100;ii++)
													{
														var body1 = {"value":ii+"%","text":ii+"%"};data1.push(body1);
													}
													userPicker13.setData(data1);
												});
											}, false);
											//节点4
											userPicker24.setData(data2);
											var showUserPickerButton24 = document.getElementById('xuanzegongxu4');
											showUserPickerButton24.addEventListener('tap', function(event) {
												userPicker24.show(function(items) {
													var content=JSON.stringify(items[0]);
													var obj = eval('(' + content + ')');
													document.getElementById("worktypeid4").value=obj.value;
													document.getElementsByName("xuanzegongxu4")[0].value=obj.text;
													document.getElementsByName("benriyingdang4")[0].value=obj.planpercent;
													document.getElementsByName("wanchengchengdu4")[0].value=obj.currentpercent;
													
													var currentpercent=obj.currentpercent.replace("%","");
													if(currentpercent=="")currentpercent=0;
													var data1=[];
													for(var ii=currentpercent;ii<=100;ii++)
													{
														var body1 = {"value":ii+"%","text":ii+"%"};data1.push(body1);
													}
													userPicker14.setData(data1);
												});
											}, false);
											
											var data1=[];
											for(var ii=0;ii<=100;ii++)
											{
												var body1 = {"value":ii+"%","text":ii+"%"};data1.push(body1);
											}
											
											userPicker1.setData(data1);
											document.getElementById('wanchengchengdu').addEventListener('tap', function(event) {
												userPicker1.show(function(items) {
													var content=JSON.stringify(items[0]);
													var obj = eval('(' + content + ')');
													document.getElementsByName("wanchengchengdu")[0].value=obj.text;
												});
											}, false);
											//完成程度1
											userPicker11.setData(data1);
											document.getElementById('wanchengchengdu1').addEventListener('tap', function(event) {
												userPicker11.show(function(items) {
													var content=JSON.stringify(items[0]);
													var obj = eval('(' + content + ')');
													document.getElementsByName("wanchengchengdu1")[0].value=obj.text;
												});
											}, false);
											//完成程度2
											userPicker12.setData(data1);
											document.getElementById('wanchengchengdu2').addEventListener('tap', function(event) {
												userPicker12.show(function(items) {
													var content=JSON.stringify(items[0]);
													var obj = eval('(' + content + ')');
													document.getElementsByName("wanchengchengdu2")[0].value=obj.text;
												});
											}, false);
											//完成程度3
											userPicker13.setData(data1);
											document.getElementById('wanchengchengdu3').addEventListener('tap', function(event) {
												userPicker13.show(function(items) {
													var content=JSON.stringify(items[0]);
													var obj = eval('(' + content + ')');
													document.getElementsByName("wanchengchengdu3")[0].value=obj.text;
												});
											}, false);
											//完成程度4
											userPicker14.setData(data1);
											document.getElementById('wanchengchengdu4').addEventListener('tap', function(event) {
												userPicker14.show(function(items) {
													var content=JSON.stringify(items[0]);
													var obj = eval('(' + content + ')');
													document.getElementsByName("wanchengchengdu4")[0].value=obj.text;
												});
											}, false);
										},
									});
								}
								
								
								
								
								
							}
						}
						
			        	var userPicker = new mui.PopPicker();
						userPicker.setData(data);
						
						var showUserPickerButton = document.getElementById('xuanzexiangmu');
						var userResult = document.getElementById('userResult');
						showUserPickerButton.addEventListener('tap', function(event) {
							userPicker.show(function(items) {
								console.log(JSON.stringify(items[0]));
								var content=JSON.stringify(items[0]);
								var obj = eval('(' + content + ')');
								
								
								document.getElementById("plmid").value=obj.value;
								document.getElementsByName("xuanzexiangmu")[0].value=obj.text;
								
								mui.ajax("http://projectnandian.jiuze9.com/projecttest/Rbac/index.php/App/worktypelist/account/"+account+"/plmid/"+obj.value,{
									dataType:'json',//服务器返回json格式数据
									type:'post',//HTTP请求类型					
									headers:{'Content-Type':'application/json'},	              
									success:function(data){
										var list = new Array();  
										list = eval(data);
										
										var data2=[];
										for (var index in list){
											if(list[index] != null){
												var content = list[index];
												var body = {
													"value":list[index]['id'],
													"text":list[index]['title'],
													"planpercent":list[index]['planpercent'],
													"currentpercent":list[index]['currentpercent']
												};
												data2.push(body);
											}
										}
										
										document.getElementById("worktypeid").value=list[0]['id'];
										document.getElementsByName("xuanzegongxu")[0].value=list[0]['title'];
							        	document.getElementsByName("benriyingdang")[0].value=list[0]['planpercent'];
							        	document.getElementsByName("wanchengchengdu")[0].value=list[0]['currentpercent'];
							        	
										userPicker2.setData(data2);
										var showUserPickerButton2 = document.getElementById('xuanzegongxu');
										showUserPickerButton2.addEventListener('tap', function(event) {
											userPicker2.show(function(items) {
												var content=JSON.stringify(items[0]);
												var obj = eval('(' + content + ')');
												document.getElementById("worktypeid").value=obj.value;
												document.getElementsByName("xuanzegongxu")[0].value=obj.text;
												document.getElementsByName("benriyingdang")[0].value=obj.planpercent;
												document.getElementsByName("wanchengchengdu")[0].value=obj.currentpercent;
												
												
												var currentpercent=obj.currentpercent.replace("%","");
												if(currentpercent=="")currentpercent=0;
												var data1=[];
												for(var ii=currentpercent;ii<=100;ii++)
												{
													var body1 = {"value":ii+"%","text":ii+"%"};data1.push(body1);
												}
												userPicker1.setData(data1);
												
												
												
											});
										}, false);
										//节点1
										userPicker21.setData(data2);
										var showUserPickerButton21 = document.getElementById('xuanzegongxu1');
										showUserPickerButton21.addEventListener('tap', function(event) {
											userPicker21.show(function(items) {
												var content=JSON.stringify(items[0]);
												var obj = eval('(' + content + ')');
												document.getElementById("worktypeid1").value=obj.value;
												document.getElementsByName("xuanzegongxu1")[0].value=obj.text;
												document.getElementsByName("benriyingdang1")[0].value=obj.planpercent;
												document.getElementsByName("wanchengchengdu1")[0].value=obj.currentpercent;
												
												var currentpercent=obj.currentpercent.replace("%","");
												if(currentpercent=="")currentpercent=0;
												var data1=[];
												for(var ii=currentpercent;ii<=100;ii++)
												{
													var body1 = {"value":ii+"%","text":ii+"%"};data1.push(body1);
												}
												userPicker11.setData(data1);
										
											});
										}, false);
										//节点2
										userPicker22.setData(data2);
										var showUserPickerButton22 = document.getElementById('xuanzegongxu2');
										showUserPickerButton22.addEventListener('tap', function(event) {
											userPicker22.show(function(items) {
												var content=JSON.stringify(items[0]);
												var obj = eval('(' + content + ')');
												document.getElementById("worktypeid2").value=obj.value;
												document.getElementsByName("xuanzegongxu2")[0].value=obj.text;
												document.getElementsByName("benriyingdang2")[0].value=obj.planpercent;
												document.getElementsByName("wanchengchengdu2")[0].value=obj.currentpercent;
												
												var currentpercent=obj.currentpercent.replace("%","");
												if(currentpercent=="")currentpercent=0;
												var data1=[];
												for(var ii=currentpercent;ii<=100;ii++)
												{
													var body1 = {"value":ii+"%","text":ii+"%"};data1.push(body1);
												}
												userPicker12.setData(data1);
											});
										}, false);
										//节点3
										userPicker23.setData(data2);
										var showUserPickerButton23 = document.getElementById('xuanzegongxu3');
										showUserPickerButton23.addEventListener('tap', function(event) {
											userPicker23.show(function(items) {
												var content=JSON.stringify(items[0]);
												var obj = eval('(' + content + ')');
												document.getElementById("worktypeid3").value=obj.value;
												document.getElementsByName("xuanzegongxu3")[0].value=obj.text;
												document.getElementsByName("benriyingdang3")[0].value=obj.planpercent;
												document.getElementsByName("wanchengchengdu3")[0].value=obj.currentpercent;
												
												var currentpercent=obj.currentpercent.replace("%","");
												if(currentpercent=="")currentpercent=0;
												var data1=[];
												for(var ii=currentpercent;ii<=100;ii++)
												{
													var body1 = {"value":ii+"%","text":ii+"%"};data1.push(body1);
												}
												userPicker13.setData(data1);
											});
										}, false);
										//节点4
										userPicker24.setData(data2);
										var showUserPickerButton24 = document.getElementById('xuanzegongxu4');
										showUserPickerButton24.addEventListener('tap', function(event) {
											userPicker24.show(function(items) {
												var content=JSON.stringify(items[0]);
												var obj = eval('(' + content + ')');
												document.getElementById("worktypeid4").value=obj.value;
												document.getElementsByName("xuanzegongxu4")[0].value=obj.text;
												document.getElementsByName("benriyingdang4")[0].value=obj.planpercent;
												document.getElementsByName("wanchengchengdu4")[0].value=obj.currentpercent;
												
												var currentpercent=obj.currentpercent.replace("%","");
												if(currentpercent=="")currentpercent=0;
												var data1=[];
												for(var ii=currentpercent;ii<=100;ii++)
												{
													var body1 = {"value":ii+"%","text":ii+"%"};data1.push(body1);
												}
												userPicker14.setData(data1);
											});
										}, false);
										
										var data1=[];
										for(var ii=0;ii<=100;ii++)
										{
											var body1 = {"value":ii+"%","text":ii+"%"};data1.push(body1);
										}
										
										userPicker1.setData(data1);
										document.getElementById('wanchengchengdu').addEventListener('tap', function(event) {
											userPicker1.show(function(items) {
												var content=JSON.stringify(items[0]);
												var obj = eval('(' + content + ')');
												document.getElementsByName("wanchengchengdu")[0].value=obj.text;
											});
										}, false);
										//完成程度1
										userPicker11.setData(data1);
										document.getElementById('wanchengchengdu1').addEventListener('tap', function(event) {
											userPicker11.show(function(items) {
												var content=JSON.stringify(items[0]);
												var obj = eval('(' + content + ')');
												document.getElementsByName("wanchengchengdu1")[0].value=obj.text;
											});
										}, false);
										//完成程度2
										userPicker12.setData(data1);
										document.getElementById('wanchengchengdu2').addEventListener('tap', function(event) {
											userPicker12.show(function(items) {
												var content=JSON.stringify(items[0]);
												var obj = eval('(' + content + ')');
												document.getElementsByName("wanchengchengdu2")[0].value=obj.text;
											});
										}, false);
										//完成程度3
										userPicker13.setData(data1);
										document.getElementById('wanchengchengdu3').addEventListener('tap', function(event) {
											userPicker13.show(function(items) {
												var content=JSON.stringify(items[0]);
												var obj = eval('(' + content + ')');
												document.getElementsByName("wanchengchengdu3")[0].value=obj.text;
											});
										}, false);
										//完成程度4
										userPicker14.setData(data1);
										document.getElementById('wanchengchengdu4').addEventListener('tap', function(event) {
											userPicker14.show(function(items) {
												var content=JSON.stringify(items[0]);
												var obj = eval('(' + content + ')');
												document.getElementsByName("wanchengchengdu4")[0].value=obj.text;
											});
										}, false);
									},
								});
								
							});
						}, false);
						
					},
				});
        	
        })
        
        //删除图片  
        function DelPic(imgId){
            var bts = ["是", "否"];  
            plus.nativeUI.confirm("是否删除图片？", function(e) {  
                var i = e.index;  
                if (i == 0) {
                        $("#d"+imgId).remove();
                        
                        console.log(imgId);
                        if(imgId=="d0")
						{
							document.getElementById("imagebox1").value="";
						}
						if(imgId=="d1")
						{
							document.getElementById("imagebox2").value="";
						}
						if(imgId=="d2")
						{
							document.getElementById("imagebox3").value="";
						}
						if(imgId=="d3")
						{
							document.getElementById("imagebox4").value="";
						}
						if(imgId=="d4")
						{
							document.getElementById("imagebox5").value="";
						}
						if(imgId=="d5")
						{
							document.getElementById("imagebox6").value="";
						}
						if(imgId=="d6")
						{
							document.getElementById("imagebox7").value="";
						}
						if(imgId=="d7")
						{
							document.getElementById("imagebox8").value="";
						}
						if(imgId=="d8")
						{
							document.getElementById("imagebox9").value="";
						}
						if(imgId=="d9")
						{
							document.getElementById("imagebox10").value="";
						}
		            }  
                },"删除图片", bts);  
        }
		var picIndex=0;
        function change() {
			if (mui.os.plus) {
				var a = [{
					title: "拍照"
				}, {
					title: "相册选取"
				}];
				plus.nativeUI.actionSheet({
					cancel: "取消",
					buttons: a
				}, function(b) {
					switch (b.index) {
						case 0:
							break;
						case 1:
							getImage(); //调用摄像头
							break;
						case 2:
							galleryImg();
							break;
						default:
							break
					}
				})
			}
		}
        
        
        function getImage() {
			var cmr = plus.camera.getCamera();
			cmr.captureImage(function(p) {
					plus.io.resolveLocalFileSystemURL(p, function(entry) {
							var path = entry.toLocalURL();
							$('#images').prepend('<div class="add-tp" id="dd' + picIndex + '">' +
								'<img src="' + path + '" onclick=DelPic("d' + picIndex + '")>' +
								'</div>');
							picIndex += 1;
							appendFile(path); //处理图片的地方
							setTimeout("upload(1)", 1000);
						},
						function(e) {
							alert("读取拍照文件错误：" + e.message);
						});
				},
				function(e) {
					//alert("失败：" + e.message);
				}, {
					filename: "_doc/camera/",
					index: 1
				});
		}
        
        
        function galleryImg() {
			plus.gallery.pick(function(path) {
				$('#images').prepend('<div class="add-tp"  id="dd' + picIndex + '">' +
					'<img src="' + path + '" onclick=DelPic("d' + picIndex + '")>' +
					'</div>');
				picIndex += 1;
				appendFile(path); //处理图片的地方
				//setTimeout("upload(2)", 1000);
			}, function(e) {
				console.log("取消选择图片");
			}, {
				filter: "none",
				system: false
			});
		}
        function getBase64(path, url){                     // 获取Base64
			var that = this;  
			var reader = new plus.io.FileReader();          // 构建文件对象  
			reader.readAsDataURL(path);                     // 添加文件（此处安卓可以直接添加文件路径，而IOS则需要文件对象）  
			reader.onloadend = function (event) {           // 文件加载 完成后的事件回调  
				//console.log('event'+JSON.stringify(event));  
				//that.o.success(url, event.target.result);   // 执行成功函数，统一把路径及base64传过去  
				base64=JSON.stringify(event);
				f1=base64;
				if(picIndex==1)
				{
					document.getElementById("imagebox1").value=f1;
				}
				if(picIndex==2)
				{
					document.getElementById("imagebox2").value=f1;
				}
				if(picIndex==3)
				{
					document.getElementById("imagebox3").value=f1;
				}
				if(picIndex==4)
				{
					document.getElementById("imagebox4").value=f1;
				}
				if(picIndex==5)
				{
					document.getElementById("imagebox5").value=f1;
				}
				if(picIndex==6)
				{
					document.getElementById("imagebox6").value=f1;
				}
				if(picIndex==7)
				{
					document.getElementById("imagebox7").value=f1;
				}
				if(picIndex==8)
				{
					document.getElementById("imagebox8").value=f1;
				}
				if(picIndex==9)
				{
					document.getElementById("imagebox9").value=f1;
				}
				if(picIndex==10)
				{
					document.getElementById("imagebox10").value=f1;
				}
			};  
		}
        function appendFile(path) {
			var img = new Image();
			img.src = path; // 传过来的图片路径在这里用。
			img.onload = function() {
				
				var that = this;
				//生成比例 
				var w = that.width,
					h = that.height,
					scale = w / h;
				w = 480 || w; //480  你想压缩到多大，改这里
				h = w / scale;
				//生成canvas
				/*
				var canvas = document.createElement('canvas');
				var ctx = canvas.getContext('2d');
				$(canvas).attr({
					width: w,
					height: h
				});
				ctx.drawImage(that, 0, 0, w, h);
				*/
			   
				plus.zip.compressImage({  
					src: path,  
					dst: path,  
					width:w,
					height:h,
					overwrite: true,  
					rotate: 0 // 不管有没有被旋转，统一旋转0度  
				}, function(e) {  
					if(mui.os.ios){ // 此处IOS需做路径转换处理，在转换时利用文件对象再去转base64，而安卓则直接可以用路径去加载文件  
						plus.io.resolveLocalFileSystemURL(e.target, function(entry){  
							entry.file(function(path){  
								console.log("P__" + JSON.stringify(path));  
								getBase64(path, e.target);   
							})  
						});   
					} else{
					   getBase64(e.target, e.target);  
					}  
				}, function(error) {  
					that.o.error(error);  
					console.log("图片旋转时发生错误!");  
				});
				
				/*
				var base64 = canvas.toDataURL('image/jpeg', 1 || 1); //1最清晰，越低越模糊。
				f1 = base64;
				if(picIndex==1)
				{
					document.getElementById("imagebox1").value=f1;
				}
				if(picIndex==2)
				{
					document.getElementById("imagebox2").value=f1;
				}
				if(picIndex==3)
				{
					document.getElementById("imagebox3").value=f1;
				}
				if(picIndex==4)
				{
					document.getElementById("imagebox4").value=f1;
				}
				if(picIndex==5)
				{
					document.getElementById("imagebox5").value=f1;
				}
				if(picIndex==6)
				{
					document.getElementById("imagebox6").value=f1;
				}
				if(picIndex==7)
				{
					document.getElementById("imagebox7").value=f1;
				}
				if(picIndex==8)
				{
					document.getElementById("imagebox8").value=f1;
				}
				if(picIndex==9)
				{
					document.getElementById("imagebox9").value=f1;
				}
				if(picIndex==10)
				{
					document.getElementById("imagebox10").value=f1;
				}
				*/
			}
		}
        
        function upload(index) {
			var url = 'http://www./Service/ConsultationManager.ashx?action=getImage';
			var dataType = 'json';
			//发送数据  
			var data = {
				files1: f1, //base64数据
				index: index
			};
			$.post(url, data, success, dataType);
			console.log('photo finish');
		}
    </script> 
    <script type="text/javascript" src="__PUBLIC__/appsource/js/immersed.js" ></script>
 </body>
</html>