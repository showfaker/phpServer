<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>调用百度地图接口单击获取地图的经纬度和定位特效-xw素材网</title>

<style type="text/css">
*{margin:0;padding:0;list-style-type:none;}
a,img{border:0;}
body{font:12px/180% Arial, Helvetica, sans-serif, "新宋体";}
.demo{width:746px;}
#l-map{height:290px;width:746px;float:left;border:1px solid #bcbcbc;}
#r-result{height:270px;width:230px;float:right;display:none}
</style>

<!-- <script type="text/javascript" src="http://api.map.baidu.com/api?v=1.4"></script> -->
<script type="text/javascript" src="https://api.map.baidu.com/api?v=1.4&type=webgl&ak=7fhIri1P7gfUhVYgn5AELs8MxieWDWsL"></script>
</head>
<body style="height:300px;">

<div class="demo" style="margin-top:8px;height:300px">
	<p style="height:30px;display:none">在地图上定位城市：<input id="txtCity" type="text"/><button  onClick="getPoint()">获取城市位置</button>
	<input id="txtPoint" type="hidden"/></p>
	<div id="l-map"></div>
	<div id="r-result"></div>
</div>

<script type="text/javascript"> 
    $lng={$lng};
	$lat={$lat};	
	var map = new BMapGL.Map("l-map");		
	if($lng){
	var point = new BMapGL.Point($lng,$lat); 
	map.centerAndZoom(point, 12);
	}else{
	map.centerAndZoom('南京', 12);
	}    	
	map.enableScrollWheelZoom();    //启用滚轮放大缩小，默认禁用
	map.enableContinuousZoom();    //启用地图惯性拖拽，默认禁用

	//map.addControl(new BMapGL.NavigationControl());  //添加默认缩放平移控件
	//map.addControl(new BMapGL.OverviewMapControl()); //添加默认缩略地图控件
	//map.addControl(new BMapGL.OverviewMapControl({ isOpen: true, anchor: BMAP_ANCHOR_BOTTOM_RIGHT }));   //右下角，打开

	var localSearch = new BMapGL.LocalSearch(map);
	localSearch.enableAutoViewport(); //允许自动调节窗体大小
	/*
	function searchByStationName() {
		map.clearOverlays();//清空原来的标注
		var keyword = document.getElementById("text_").value;
		localSearch.setSearchCompleteCallback(function (searchResult) {
			var poi = searchResult.getPoi(0);
			document.getElementById("result_").value = poi.point.lng + "," + poi.point.lat;
			map.centerAndZoom(poi.point, 13);
			var marker = new BMapGL.Marker(new BMapGL.Point(poi.point.lng, poi.point.lat));  // 创建标注，为要查询的地方对应的经纬度
			map.addOverlay(marker);
			var content = document.getElementById("text_").value + "<br/><br/>经度：" + poi.point.lng + "<br/>纬度：" + poi.point.lat;
			var infoWindow = new BMapGL.InfoWindow("<p style='font-size:14px;'>" + content + "</p>");
			marker.addEventListener("click", function () { this.openInfoWindow(infoWindow); });
			// marker.setAnimation(BMAP_ANIMATION_BOUNCE); //跳动的动画
		});
		localSearch.search(keyword);
	} 
	searchByStationName();
	*/
	var markercurrent = new BMapGL.Marker(new BMapGL.Point($lng,$lat));  // 创建标注，为要查询的地方对应的经纬度
	map.addOverlay(markercurrent);
	map.addEventListener("click",function(e){
		map.clearOverlays();//清空原来的标注
		var marker = new BMapGL.Marker(new BMapGL.Point(e.latlng.lng, e.latlng.lat));  // 创建标注，为要查询的地方对应的经纬度
		map.addOverlay(marker);
		document.getElementById("txtPoint").value=e.latlng.lng + "," + e.latlng.lat;
		parent.document.getElementById("jw").value=e.latlng.lng + "," + e.latlng.lat;
		parent.document.getElementById("lat").value=e.latlng.lat;
		parent.document.getElementById("lng").value=e.latlng.lng;
		
		
		var geoc = new BMapGL.Geocoder(); //地址解析对象
		geoc.getLocation(e.latlng, function (rs) 
		{
			var addComp = rs.addressComponents;
			var address = addComp.province + addComp.city + addComp.district + addComp.street + addComp.streetNumber;//addComp.district + addComp.province + addComp.city + 
			parent.document.getElementById('address_temp').value = address;
			//parent.calctotalForTitle();
		});
		
	});
</script>

<script type="text/javascript">
	// 百度地图API功能
	/*
	var map = new BMapGL.Map("l-map");            // 创建Map实例
	map.centerAndZoom(new BMapGL.Point(116.404, 39.915), 4);
	map.enableScrollWheelZoom();
	var local = new BMapGL.LocalSearch("全国", {
	  renderOptions: {
		map: map,
		panel : "r-result",
		autoViewport: true,
		selectFirstResult: false
	  }
	});
	map.addEventListener("click",function(e){
	document.getElementById("txtPoint").value=e.point.lng + "," + e.point.lat;
	});
	*/
	var local = new BMapGL.LocalSearch("全国", {
		  renderOptions: {
			map: map,
			panel : "r-result",
			autoViewport: true,
			selectFirstResult: false
		  }
	});
	function getPoint(){
		var city = document.getElementById("txtCity").value;
		local.search(city);                 // 初始化地图,设置城市和地图级别。
											//启用滚轮放大缩小
	}
</script>

</body>
</html>