	<link rel="shortcut icon" href="favicon.ico"> <link href="css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="css/font-awesome.css?v=4.4.0" rel="stylesheet">
    <link href="css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css?v=4.1.0" rel="stylesheet">
	<link rel="stylesheet" href="css/main.css">
	<div class="modal-header">
	<button type="button" class="close" data-dismiss="modal">×</button>
	<h4 class="modal-title">设置时间</h4>
	</div>
	<form  method="post" action="__URL__/settimeSubmit" enctype="multipart/form-data" class="form-horizontal"> 
		<div class="modal-body">
        <div style="margin:0 auto;width:80%">
				<table class="table table-striped table-bordered table-hover " id="editable" width="80%" style="margin:0 auto;">
					<thead>
						<tr>
							<th width="40%">时间节点</th>
							<th width="40%">金额</th>
							<th width="20%">操作</th>
						</tr>
					</thead>
					<tbody>
						<volist name="order_paytime" id="material">
						<tr id="table-row-0">
							<td style="text-align: center;">{$material.paytime}</td>
							<td style="text-align: center;">{$material.pay}</td>
							<td style="text-align: center;">
								<eq name='material.status' value='0'>
									<neq name="material.paytime" value=""><b style="color:orange;">未付款</b></neq>
								</eq>

								<eq name='material.status' value="1"><b style="color:green;">已付款</b></eq>
								<eq name='material.status' value="0">
									<eq name="material.paytime" value="">
										<button class="btn btn-xs btn-info" title="{$material.id}" id="btn" type="button">
											<input type="hidden" name="id" value="{$material.id}">设置时间
										</button>
									</eq>
								</eq>
							</td>
						</tr>
						</volist>
					</tbody>
				</table>
		</div>

		<div style="margin:20px auto;width:80%;display: none;" id="div">
			<div class="">
				<a onclick="fnClickAddRow();" href="javascript:void(0);" class="btn btn-primary ">添加行</a>
			</div>
			<table class="table table-striped table-bordered table-hover " id="editable2">
					<thead>
						<tr>
							<th width="40%">时间节点</th>
							<th width="40%">金额</th>
							<th width="20%">操作</th>
						</tr>
					</thead>
					<tbody>
						<tr id="table-row-0">
							<td><input placeholder="请选择时间节点" class="form-control layer-date" name="time[]"value="" onclick="laydate({istime: true, format: 'YYYY-MM-DD'})" style="width:250px;float:left;margin-right:10px">
							</td> 
							<!-- </td> -->
							<td><input type="text" placeholder="价格"  class="form-control price" size="25%" name="price[]">
							</td>

							<td>						
								<a class="btn btn-danger btn-xs delete" href="javascript:void(0);">删除</a>
							</td>				
						</tr>
					</tbody>
			</table>
		</div>			
		</div>	
		<div class="modal-footer">
			<button type="button" class="btn btn-sm btn-white pull-right m-t-n-xs" data-dismiss="modal" style="margin-left:10px">关闭</button>
			<button type="button" id="submit1" class="btn btn-sm btn-info pull-right m-t-n-xs" style="margin-left:10px">提交</button>
			<button type="submit" id="submit2" class="hidden" style="margin-left:10px">提交</button>
			
		</div>
	</form>
<script>
	var pay=$('#btn').parents('tr').find('td').eq(1).html();
	$('#btn').click(function(){
		$(this).attr('title');
		$('#div').css('display','block');
	});
	function fnClickAddRow() {
        	var flag=0;
        	$('input[name="time[]"]').each(function(i){
        		if($(this).val()==''){
        			alert('已经有未设置时间的节点.');
        			flag=1;
        		}
        	});
        	if(flag==0){
        		$('#editable2').dataTable().fnAddData([
				    '<input type="text" placeholder="请选择时间节点" class="form-control layer-date" name="time[]" value="" style="width:250px;float:left;margin-right:10px"/>',
					'<input type="text" placeholder="价格" class="form-control price" size="25%" name="price[]" onblur="jisuan()">',
					'<a class="btn btn-danger btn-xs delete" href="javascript:void(0);">删除</a>'
					]);
				$('.layer-date').click(function(){
					laydate({istime: true, format: 'YYYY-MM-DD'});
				});
				$('.delete').on('click', function(e) {
					var table = $('#editable2').DataTable();
					table.row($(this).parents('tr')).remove().draw();
				});
				$('select').attr('class','form-control');
        	}
	            
        }
    $('#submit1').click(function(){
    	var total=0;
    	total=parseFloat(total);
    	$('input[name="price[]"]').each(function(i){
    		total=total+parseFloat($(this).val());
    	});
    	if(total>pay){
    		alert('分配金额大于未分配金额,请重新分配.');
    	}else{
    		$('#submit2').click();
    	}
    });
</script>
