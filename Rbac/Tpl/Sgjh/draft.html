


	<form id="sgjhform" method="post" action="__URL__/draftsubmit" enctype="multipart/form-data" class="form-horizontal" onsubmit="return false;">    <!-- onsubmit="return false;" -->
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
			<h4 class="modal-title">设备到货计划</h4>
		</div>
		<input type="hidden" value="{$orgdata.id}" name="id">
		<input type="hidden" value="{$change}" name="change">
		<input type="hidden" value="{$moduletitle}" name="moduletitle">
		
		<div style="height:500px;overflow-y:scroll;padding:20px">
			<table id="wizard" style="width:100%;" class="table table-striped table-bordered table-hover">
				<!-- <input type="hidden" value="{$worktype.id}" name="worktype[]"> -->
				<volist name="worktypes" id="worktype" key="k">
				<tr>
				<td style="width:18%">
					<p class="i-checks"><input class="{$worktype.title}" type="checkbox" value="{$worktype.id}" name="worktypeid[{$key}]" id="worktypeid{$k-1}" onclick="sethtml(this,{$k-1})" <in name="worktype.title" value="$pcheckedworktype">checked</in>>{$worktype.title}</p>
				</td>
				<td style="width:7%">
					<p>{$worktype.period}天</p>
				</td>
				<td class="step-content" style="width:75%">
					<div class="text-center" id="td{$k-1}">
						
								<in name="worktype.title" value="$pcheckedworktype">
								<input type="hidden" id="currentrow{$k-1}" value="{$worktype.schedulecount}">
								<div style="text-align:left">
									<a onclick="fnClickAddRow({$k-1});" href="javascript:void(0);" class="btn btn-primary btn-xs" >添加批次</a>
								</div>
								<div style="overflow-y:auto;overflow-x:hidden;">
								<table class="table table-striped table-bordered" id="editable{$k-1}">
									<thead>
										<tr>
											<th width="10%">批次</th>
											<th width="10%">数量</th>
											<th width="20%">计划开始日期</th>
											<th width="20%">计划完成日期</th>
											<th width="10%">操作</th>
										</tr>
									</thead>
									<tbody>
										<volist name="worktype.schedules" id="schedule" key="i">
										<tr>
										<td width="10%"><input type="text" class="form-control" style="width:100px;" name="branch{$k-1}[]" id="period{$k-1}_{$i-1}" value="{$schedule.branch}"></td>
										<td width="10%"><input type="text" class="form-control" style="width:100px;" name="plancount{$k-1}[]" id="plancount{$k-1}_{$i-1}" value="{$schedule.plancount}"></td>
										<td width="20%"><input type="text" class="form-control" style="width:120px;" name="plantimebegin{$k-1}[]" id="plantimebegin{$k-1}_{$i-1}" onclick="takeplantimebegin({$k-1},{$i-1})" value="{$schedule.plantimebegin}"></td>
										<td width="20%"><input type="text" class="form-control" style="width:120px;" name="plantimeend{$k-1}[]" id="plantimeend{$k-1}_{$i-1}" onclick="laydate({istime: false, format: 'YYYY-MM-DD'})" value="{$schedule.plantimeend}"></td>
										<td width="10%"><a class="btn btn-danger btn-xs delete" title="{$k-1}" href="javascript:void(0);">删除</a></td>
										</tr>
										</volist>
									</tbody>
								</table>
								</div>
								</in>
							
						
					</div>
				</td>
				</tr>
				
				</volist>
				
				
				<script>
					function sethtml(obj,key)
					{
						console.log(key);
						if(obj.checked==false)
						{
							document.getElementById("td"+key).innerHTML="";
						}
						else
						{
							document.getElementById("td"+key).innerHTML='<input type="hidden" id="currentrow'+key+'" value="1"><div style="text-align:left">\
									<a onclick="fnClickAddRow('+key+');" href="javascript:void(0);" class="btn btn-primary btn-xs" >添加批次</a>\
								</div>\
								<div style="overflow-y:auto;overflow-x:hidden;">\
								<table class="table table-striped table-bordered" id="editable'+key+'">\
									<thead>\
										<tr>\
											<th width="10%">批次</th>\
											<th width="10%">数量</th>\
											<th width="20%">计划开始日期</th>\
											<th width="20%">计划完成日期</th>\
											<th width="10%">操作</th>\
										</tr>\
									</thead>\
									<tbody>\
										<tr id="table-row-0">\
										<td width="10%"><input type="text" class="form-control" style="width:100px;" name="branch'+key+'[]" id="period'+key+'_0" ></td>\
										<td width="10%"><input type="text" class="form-control" style="width:100px;" name="plancount'+key+'[]" id="plancount'+key+'_0" value=""></td>\
										<td width="20%"><input type="text" class="form-control" style="width:120px;" name="plantimebegin'+key+'[]" id="plantimebegin'+key+'_0" onclick="takeplantimebegin('+key+',0)"></td>\
										<td width="20%"><input type="text" class="form-control" style="width:120px;" name="plantimeend'+key+'[]" id="plantimeend'+key+'_0" onclick="laydate({istime: false, format:'+"'"+"YYYY-MM-DD"+"'"+'})"></td>\
										<td width="10%"><a class="btn btn-danger btn-xs delete" title="'+key+'" href="javascript:void(0);">删除</a></td>\
										</tr>\
									</tbody>\
								</table>\
								</div>';
						}
						
					}
				</script>
				
			</table>
		</div>
	
		
		<input type="hidden" name="sgjhissave" id="sgjhissave" value="0">
		<div class="modal-footer">
			<!-- <button type="submit" class="btn btn-warning" id="savesubmit">保存</button> -->
			<button type="submit" class="btn btn-danger" id="submit">提交</button> <!-- id="submit" -->
			<button type="button" class="btn btn-white" data-dismiss="modal">关闭</button>
		</div>
	</form>
		

	<script type="text/javascript" src="__PUBLIC__/js/jquery-form.js" ></script>
	<script>
	
		
		document.getElementById("submit").addEventListener("click",function(){
			document.getElementById("sgjhissave").value=0;
			$('#sgjhform').ajaxSubmit({
				dataType:'json',//服务器返回json格式数据
				type: "post",
				url: "__APP__/Sgjh/draftsubmit/",
				data: $('#sgjhform').serialize(),
				error: function (data) {
					console.log(data);
					alert('服务器连接超时，请稍后再试');  
				},
				success: function (data) {
					var result = new Array();  
					result = eval(data);
					if(result['message']=="操作成功!")
					{
						alert("操作成功");
						location.href=location.href;
					}else{
						alert(result['message']);
					}
				}
			});
		});
		
	</script>
	<script src="js/plugins/jeditable/jquery.jeditable.js"></script>
    <script src="js/plugins/dataTables/jquery.dataTables.js"></script>
    <script src="js/plugins/dataTables/dataTables.bootstrap.js"></script>



	<script>
        function find1(e){
			var id=$("input[name='id']").val();
			$(e).attr("href","__URL__/choice/key/"+e.title+"/id/"+id); 
		}
    	
	</script>
    <script>
        function fnClickAddRow(key) {
			console.log(key);
			var currentrow=$("#currentrow"+key).val();
			if(currentrow<1)currentrow=1;
			console.log(currentrow);
            $('#editable'+key).dataTable().fnAddData([
                '<td><input type="text" class="form-control" style="width:100px;" name="branch'+key+'[]" value="" id="period'+key+"_"+currentrow+'"></td>',
				'<td><input type="text" class="form-control" style="width:100px;" name="plancount'+key+'[]" value="" id="plancount'+key+"_"+currentrow+'"></td>',
				'<td><input type="text" class="form-control" style="width:120px;" name="plantimebegin'+key+'[]" value="" id="plantimebegin'+key+"_"+currentrow+'" onclick="takeplantimebegin('+key+','+currentrow+')"></td>',
				'<td><input type="text" class="form-control" style="width:120px;" name="plantimeend'+key+'[]" value="" id="plantimeend'+key+"_"+currentrow+'" onclick="laydate({istime: false, format: '+"'"+'YYYY-MM-DD'+"'"+'})"></td>',
				'<td><a class="btn btn-danger btn-xs delete" href="javascript:void(0);">删除</a></td>'
				]);
				currentrow++;
				$('#currentrow'+key).val(currentrow);
				$('.delete').on('click', function(e) {
					var table = $('#editable'+key).DataTable();
					table.row($(this).parents('tr')).remove().draw();
				});
        }
		$('.delete').on('click', function(e) {
			var title=$(this).attr("title");
			var table = $('#editable'+title).DataTable();
			table.row($(this).parents('tr')).remove().draw();
		});
		
    </script>
    
	<script>
	var id="<?php echo $orgdata["id"];?>";
	var moduletitle="<?php echo $moduletitle;?>";
	
	function takeplantimebegin(key,i)
	{
		var worktypeid=$("#worktypeid"+key).val();
		console.log(worktypeid);
		laydate({
			istime: false,
			istoday: false,
			format: 'YYYY-MM-DD',
			choose: function(value, date)
			{
				//alert('你选择的日期是：' + value + '\n获得的对象是' + JSON.stringify(date));
				var aj = $.ajax({
					url:'__APP__/Sgjh/gettimeend1',
					data:{
						id:id,
						worktypeid:worktypeid,
						moduletitle:moduletitle,
						date:value
					},
					type:'post',  
					cache:false,  
					dataType:'json',
					success:function(data) {
						console.log(data);
						$("input[id='plantimeend"+key+"_"+i+"']").val(data);
					}  
				});
			
			}
		});
	}
	</script>

   
	