
<script type="text/javascript" >
	function getrootpath() {
		//获取当前网址，如： http://localhost:8080/ems/Pages/Basic/Person.jsp
		var curWwwPath = window.document.location.href;
		//获取主机地址之后的目录，如： /ems/Pages/Basic/Person.jsp
		var pathName = window.document.location.pathname;
		var pos = curWwwPath.indexOf(pathName);
		//获取主机地址，如： http://localhost:8080
		var localhostPath = curWwwPath.substring(0, pos);
		//获取带"/"的项目名，如：/ems
		var projectName = pathName.substring(0, pathName.substr(1).indexOf('/') + 1);
		projectName = projectName.replace("/Rbac","");
		return(localhostPath + projectName);
	}

	function selectGroupmulti(arg1,arg2){
		var rootpath=getrootpath();
		asyncbox.open({
			id : "form",
			title:'',
			url :rootpath+'/Rbac/index.php?s=/Public/selectmulti/arg1/'+arg1+'/arg2/'+arg2,
			width : 445,
			height : 400,
			//btnsbar : $.btn.ok,
			callback : function(action){
				if(action == 'close'){  
					return;
				}
			}
		});
	}

	function selectGroup(arg1,arg2){
		var rootpath=getrootpath();
		asyncbox.open({
			id : "form",
			title:'',
			url :rootpath+'/Rbac/index.php?s=/Public/select/arg1/'+arg1+'/arg2/'+arg2,
			width : 445,
			height : 400,
			//btnsbar : $.btn.ok,
			callback : function(action){
				if(action == 'close'){  
					return;
				}
			}
		});
	}
	function selectWorker(arg1,arg2){
		var rootpath=getrootpath();
		asyncbox.open({
			id : "form",
			title:'',
			url :rootpath+'/Rbac/index.php?s=/Public/selectworker/arg1/'+arg1+'/arg2/'+arg2,
			width : 445,
			height : 400,
			//btnsbar : $.btn.ok,
			callback : function(action){
				if(action == 'close'){  
					return;
				}
			}
		});
	}
</script>
<style>
	.check{
		width:60% ;
		height:70%;
		position: fixed;
		top:15%;
		left: 20%;
		z-index:100000;
		background-color:#f8f8f8;
	}
	.background{
		width:100% ;
		height:100%;
		position: fixed;
		top:0%;
		left:0%;
		z-index:90000;
		background-color:#808080;
		opacity:0.7;
		border:none;
	}
	.tab-pane{
		overflow:auto;
		max-height:98%;
	}
</style>
<div class="modal-header" style="text-align: left;">
	<button type="button" class="close" data-dismiss="modal">×</button>
	<h4 class="modal-title" >更新会议计划</h4>
</div>
<div class="background" style="display:none"></div>
<div class="check" style="display:none">
	<div class="col-sm-12 control-label" style="height:90%">
		<div class="tabs-container" style="height:100%">
			<ul class="nav nav-tabs">
				<li class="col-sm-4  col-xs-4  active" type="公司"><a data-toggle="tab" href="#tab-1" aria-expanded="true">公司</a></li>
				<li class="col-sm-4 col-xs-4" type="部门"><a data-toggle="tab" href="#tab-2" aria-expanded="false">部门</a></li>
				<li class="col-sm-4 col-xs-4" type="个人"><a data-toggle="tab" href="#tab-3" aria-expanded="false">个人</a></li>
			</ul>
			<div class="tab-content" style="height:90%">
				<div id="tab-1" class="tab-pane active" >
					<div class="panel-body company">
						<label class="col-sm-12" style="text-align:left;font-weight: normal;" >
							<input type="checkbox" value="公司" checked disabled> 公司
						</label>
					</div>
				</div>
				<div id="tab-2" class="tab-pane" >
					<div class="panel-body department">
						<volist name="dept" id="depts">
							<label class="col-sm-3" style="text-align:left;font-weight: normal;">
								<input type="checkbox" value="{$depts.name}" name="department"> {$depts.name}
							</label>
						</volist>
					</div>
				</div>
				<div id="tab-3" class="tab-pane" >
					<div class="panel-body personal">
						<table class="table table-striped table-bordered table-hover">
							<volist name="dept" id="depts">
								<tr>
									<td width="50%" >
										<label class="col-sm-12" style="text-align:left;font-weight: normal;" >
											<input type="checkbox" value="{$depts.name}" name="department" class="departments" >{$depts.name}
										</label>
									</td>
									<td width="50%">
										<volist name="depts.user" id="user">
											<label class="col-sm-12" style="text-align:left;font-weight: normal;" >
												<input type="checkbox" value="{$user.nickname}" name="personal" class="personals">{$user.nickname}
											</label>
											<br/>
										</volist>	
									</td>
								</tr>
							</volist>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div style="height:10%;padding:2%">
		<a class="btn btn-primary btn-xs seal" href="javascript:void(0);">确定</a>
		<a class="btn btn-white btn-xs shut" href="javascript:void(0);">取消</a>
	</div>
</div>
<form method="post" action="__URL__/updates" class="form-horizontal">
	<input type="hidden" name="id" value="{$vo.id}">
	<div class="modal-body" >
		<div class="form-group">
			<label class="col-sm-3  col-xs-3 control-label">所属项目<font style="color:red">*</font>：</label>
			<div class="col-sm-8  col-xs-8">
				<select name="plmid" data-placeholder="选择项目" class="form-control" required>
					<option value="">请选择项目</option>
					<volist name="allprojects" id="project">
						<option value="{$project.id}" hassubinfo="true" <eq name="project.id" value="$vo.plmid">selected</eq>>{$project.title}</option>
					</volist>
				</select>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">专项节点<font style="color:red">*</font>：</label>
			<div class="col-sm-8 col-xs-8">
				<select name="group" data-placeholder="选择专项节点" class="form-control" required>
					<option value="">请选专项节点</option>
					<option value="开发" <eq name="vo.group" value="开发">selected</eq>>开发</option>
					<option value="设计" <eq name="vo.group" value="设计">selected</eq>>设计</option>
					<option value="采购" <eq name="vo.group" value="采购">selected</eq>>采购</option>
					<option value="施工" <eq name="vo.group" value="施工">selected</eq>>施工</option>
				</select>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">会议名称<font style="color:red">*</font>：</label>
			<div class="col-sm-8 col-xs-8">
				<input class="form-control" type="text" name="title" size="60" value="{$vo.title}" required>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">会议分类<font style="color:red">*</font>：</label>
			<div class="col-sm-8 col-xs-8">
				<select class="form-control"  name="type1" required>
					<option value="">请选择会议分类</option>
					<volist name="meetingset1" id="setlist1">
						<option value="{$setlist1.name}" <eq name="setlist1.name" value="$vo.type1">selected</eq>>{$setlist1.name}</option>
					</volist>
				</select>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">会议属性<font style="color:red">*</font>：</label>
			<div class="col-sm-8 col-xs-8">
				<select class="form-control"  name="type2" required>
					<option value="">请选择会议属性</option>
					<volist name="meetingset2" id="setlist2">
						<option value="{$setlist2.name}" <eq name="setlist2.name" value="$vo.type2">selected</eq>>{$setlist2.name}</option>
					</volist>
				</select>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">会议级别<font style="color:red">*</font>：</label>
			<div class="col-sm-8 col-xs-8">
				<select class="form-control"  name="type3" required>
					<option value="">请选择会议级别</option>
					<volist name="meetingset3" id="setlist3">
						<option value="{$setlist3.name}" <eq name="setlist3.name" value="$vo.type3">selected</eq>>{$setlist3.name}</option>
					</volist>
				</select>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">会议模板：</label>
			<div class="col-sm-8 col-xs-8">
				<select class="form-control"  name="type4" id="type4">
					<option value="">请选择会议模板</option>
					<volist name="meetingset4" id="setlist4">
						<option value="{$setlist4.id}" <eq name="setlist4.id" value="$vo.type4">selected</eq>>{$setlist4.name}</option>
					</volist>
				</select>
			</div>
		</div>
		
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">开始日期<font style="color:red">*</font>：</label>
			<div class="col-sm-8 col-xs-8">
				<input type="text" class="form-control" onclick="laydate({istime: false, format: 'YYYY-MM-DD'})" autocomplete="off"  name="timebegin" value="{$vo.timebegin}" required>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">结束日期<font style="color:red">*</font>：</label>
			<div class="col-sm-8 col-xs-8">
				<input type="text" class="form-control" onclick="laydate({istime: false, format: 'YYYY-MM-DD'})" autocomplete="off"  name="timeend" value="{$vo.timeend}" required>
			</div>
		</div>

		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">会议周期：</label>
			<div class="col-sm-8 col-xs-8">
				<select id="circle" name="circle" class="form-control" style="width:40%;float:left">
					<option value="1"  <eq name="vo.circle" value="1">selected</eq>>每天</option>
					<option value="2" <eq name="vo.circle" value="2">selected</eq>>每星期</option>
					<option value="3" <eq name="vo.circle" value="3">selected</eq>>每月</option>
				</select>
				<!-- 每星期 -->
				<select name="week" class="form-control cycle2" style='width:40%;float:left;margin-left:20px;<neq name="vo.circle" value="2">display:none;</neq>' >
					<option value="Monday" <eq name="vo.week" value="Monday">selected</eq>>周一</option>
					<option value="Tuesday" <eq name="vo.week" value="Tuesday">selected</eq>>周二</option>
					<option value="Wednesday" <eq name="vo.week" value="Wednesday">selected</eq>>周三</option>
					<option value="Thursday" <eq name="vo.week" value="Thursday">selected</eq>>周四</option>
					<option value="Friday" <eq name="vo.week" value="Friday">selected</eq>>周五</option>
					<option value="Saturday" <eq name="vo.week" value="Saturday">selected</eq>>周六</option>
					<option value="Sunday" <eq name="vo.week" value="Sunday">selected</eq>>周日</option>
				</select>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label"></label>
			<div class="col-sm-8 col-xs-8">
				<input type="number" name="day" max="31" min="1" value="{$vo.day}" class="form-control cycle3" style='width:20%;float:left;<neq name="vo.circle" value="3">display:none;</neq>' >
				<span style='float:left;padding: 6px 5px;<neq name="vo.circle" value="3">display:none;</neq>' class="cycle3">日</span>

				<input type="number" name="hour" max="23" value="{$vo.hour}" min="0" class="form-control" style="width:20%;float:left" >
				<span style="float:left;padding: 6px 5px;">小时</span>
				
				<input type="number" name="minute" max="59" value="{$vo.minute}" min="0" class="form-control" style="width:20%;float:left" >
				<span style="float:left;padding: 6px 5px;">分钟</span>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">会议目标：</label>
			<div class="col-sm-8 col-xs-8">
				<input type="text" name="aim" class="form-control" value="{$vo.aim}" />
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">记录人：</label>
			<div class="col-sm-8 col-xs-8">
				<input type="text" id="recorder" name="recorder" value="{$vo.recorder}" class="form-control" readonly placeholder="点击获取人员" onclick="show('#recorder')">
				<!-- <input type="hidden" id="recorder" name="recorder" value="{$vo.recorder}" /> -->
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">参会人<font style="color:red">*</font>：</label>
			<div class="col-sm-8 col-xs-8">
				<input type="text" id="attendee" name="attendee" value="{$vo.attendee}" class="form-control" readonly placeholder="点击获取人员" onclick="show('#attendee')" required>
				<!-- <input type="hidden" id="attendee" name="attendee" value="{$vo.attendee}"/> -->
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">议程：</label>
			<div class="col-sm-8 col-xs-8">
				<textarea class="form-control" name="agenda" id="agenda" rows="12" cols="60" tools="simple" upLinkUrl="{editorRoot}upload.php" upLinkExt="zip,rar,doc,docx" upImgUrl="{editorRoot}upload.php"  upImgExt="jpg,jpeg,gif,png">{$vo.agenda}</textarea>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">上会资料：</label>
			<div class="col-sm-8 col-xs-8">
				<textarea class="form-control" name="materials" id="materials" rows="12" cols="60" tools="simple" upLinkUrl="{editorRoot}upload.php" upLinkExt="zip,rar,doc,docx" upImgUrl="{editorRoot}upload.php"  upImgExt="jpg,jpeg,gif,png">{$vo.materials}</textarea>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">会议内容：</label>
			<div class="col-sm-8 col-xs-8">
				<textarea class="form-control" name="content" rows="12" cols="60" tools="simple" upLinkUrl="{editorRoot}upload.php" upLinkExt="zip,rar,doc,docx" upImgUrl="{editorRoot}upload.php"  upImgExt="jpg,jpeg,gif,png">{$vo.content}</textarea>
			</div>
		</div>
	</div>
	<div class="modal-footer">
		<button type="button" class="btn btn-sm btn-white pull-right m-t-n-xs" data-dismiss="modal" style="margin-left:10px">关闭</button>
		<button class="btn btn-sm btn-primary pull-right m-t-n-xs" type="submit" id='submit'><strong>确定</strong>
		</button>
	</div>
</form>
<script>
	$("#type4").change(function(){
		$("#agenda").val("");
		$("#materials").val("");
		var id = $(this).val();
		console.log(id);
		//查找会议模版
		$.ajax({
			url:'__URL__/find_meeting_mode',
			data:{
				id : id
			},
			type:'post',  
			cache:false,  
			dataType:'json',  
			success:function(data) {			
				console.log(data);
				if(data.status == "OK"){
					$("#attendee").val(data.data.attendee);
					$("#check").val(data.data.attendee);
					$("#agenda").val(data.data.agenda);
					$("#materials").val(data.data.materials);
				}else{
					$("#attendee").val("");
					$("#agenda").val("");
					$("#check").val("");
					$("#materials").val("");
				}
			}  
		});
	})
</script>

<script>	
	$("#circle").change(function(){
		$(".cycle2").hide();
		$(".cycle3").hide();
		if($(this).val() == "3"){
			$(".cycle3").show();
		}else if($(this).val() == "2"){
			$(".cycle2").show();
		}
	})
</script>
<script>
	choice = "";
	that = '';
	choose ="";
	function current_change(e){
		$(".para2").val(e);
	}

	function show(e){
		choose = e;
		choice = "all";
		$(".check").show();
		$(".background").show();
		
	}

	$("#editable").on('click',".para2", function(){
		choice = "only";
		that = $(this);
		$(".check").show();
		$(".background").show();

	})
	$(".seal").click(function(){
		if(choice == "all"){
			if($("li.active").attr("type") == "公司"){
				$(".para2").val("公司");
				$(choose).val("公司");
			}else if($("li.active").attr("type") == "部门"){
				var department =[];
				$('input[name="department"]:checked').each(function(){
					department.push($(this).val());
				});
				var department = department.join(",");
				$(".para2").val(department);
				$(choose).val(department);
			}else{
				var personal =[];
				$('input[name="personal"]:checked').each(function(){
					personal.push($(this).val());
				});
				var personal = personal.join(",");
				$(".para2").val(personal);
				$(choose).val(personal);
			}
		}else{
			if($("li.active").attr("type") == "公司"){
				that.val("公司");
			}else if($("li.active").attr("type") == "部门"){
				var department =[];
				$('input[name="department"]:checked').each(function(){
					department.push($(this).val());
				});
				var department = department.join(",");
				that.val(department);
			}else{
				var personal =[];
				$('input[name="personal"]:checked').each(function(){
					personal.push($(this).val());
				});
				var personal = personal.join(",");
				that.val(personal);
			}
			$('input[name="personal"]').removeAttr("checked");
			$('input[name="department"]').removeAttr("checked");
		}
		$(".check").hide();
		$(".background").hide();
	})
	$(".shut").click(function(){
		$(".check").hide();
		$(".background").hide();
	})

	$(".departments").click(function(){
		if($(this).is(':checked')){
			$(this).parent().parent().parent().children().find(".personals").prop("checked",'checked');//全选 
		}else{
			$(this).parent().parent().parent().children().find(".personals").removeAttr("checked");//全选 
		}
	})
</script>