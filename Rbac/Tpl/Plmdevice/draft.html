	<link rel="shortcut icon" href="favicon.ico"> <link href="css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="css/font-awesome.css?v=4.4.0" rel="stylesheet">

    <!-- Data Tables -->
    <link href="css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">
    <link href="css/plugins/chosen/chosen.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css?v=4.1.0" rel="stylesheet">
	<link rel="stylesheet" href="css/main.css">
	<link href="css/plugins/iCheck/custom.css" rel="stylesheet">


	<form id="format1" method="post" action="__URL__/insert" enctype="multipart/form-data" class="form-horizontal">    
		<div class="modal-body" style="padding:0px;margin:0px">
			<div class="form-group">
				<div class="col-sm-12" style="margin-bottom: 20px;">
					<label class="col-sm-2 control-label">选择项目：</label>
					<div class="col-sm-4">
					    <select name="plmid" data-placeholder="请选择项目" class="chosen-select" style="width:230px;">
							<option value="">请选择项目</option>
							<volist name="projects" id='project'>
							<option value="{$project.id}" hassubinfo="true">{$project.title}</option>
							</volist>
						</select>
					</div>
					
					<label class="col-sm-2 control-label">选择分组：</label>
					<div class="col-sm-4">
					    <select name="groupid" data-placeholder="请选择分组" style="width:230px;" class="form-control" tabindex="2">
							<option value="">请选择分组</option>
						</select>
					</div>
				</div>
				<div class="col-sm-12" style="margin-bottom: 20px;">	
					
					<label class="col-sm-2 control-label">项目阶段：</label>
					<div class="col-sm-4">
						<select name="step" data-placeholder="请选择阶段" style="width:230px;" class="form-control" tabindex="2">
							<option value="">请选择阶段</option>
						</select>
					</div>
					
					
					<label class="col-sm-2 control-label">日期：</label>
					<div class="col-sm-4">
					    <input class="form-control" name="date" style="width:230px" onclick="laydate({istime: false, format: 'YYYY-MM-DD'})" autocomplete="off" value="<?php echo date("Y-m-d");?>">
					</div>
				</div>
			</div>
			<div style="height:300px;overflow-y:auto;overflow-x:hidden;">
			<table class="table table-striped table-bordered table-hover " id="editable">
				
				<tr>
					<th width="6%">分组</th>
					<th width="6%">设备类型</th>
					<th width="6%">设备编号</th>
					<th width="6%">设备名称</th>
					<th width="6%">型号</th>
					<th width="6%">车牌</th>
					<th width="6%">在岗</th>
					<th width="6%">日租金</th>
				</tr>
				<tbody class="i-checks" id="t_able">
					<!--
					<volist name="workers" id="worker">
					<neq name="worker" value="">
					<tr class="i-checks">
						<td>{$worker.group}<input type="hidden" value="{$worker.group}" name="group_{$worker.deviceid}"><input type="hidden" value="{$worker.groupid}" name="groupid_{$worker.deviceid}"></td> 
						<td>{$worker.number}</td> 
						<td>{$worker.device}</td>
						<td>{$worker.model}</td> 
						<td>{$worker.plate}</td>
						<td class="i-checks">在岗<input type="radio" value="在岗" name="status_{$worker.deviceid}" checked required="" aria-required="true">
							离岗<input type="radio" value="离岗" name="status_{$worker.deviceid}" required="" aria-required="true">
						</td>
						<td class="i-checks"><input type="text" value="0" class="form-control" name="money_{$worker.deviceid}" checked required="" aria-required="true">
						</td> 
					</tr>
					</neq>
					</volist>
					-->
				</tbody>
			</table>
			</div>
		</div>
		<div class="modal-footer">
			<a href="#" onclick="changeout()" class="btn btn-primary">确认提交</a>
			<button id="btnclick" class="btn btn-primary hidden"></button>
		</div>
	</form>
	<div id="modal" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
	  <div class="modal-dialog" style="width:850px;height:600px">
		<div class="modal-content">
		   <div class="modal-header">  
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">  
                    <span aria-hidden="true">×</span>  
                </button>  
                <h4 class="modal-title" id="myModalLabel">Modal title</h4>  
            </div>  
            <div class="modal-body">  
                <p>One fine body…</p>  
            </div>  
            <div class="modal-footer">  
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>  
                <button type="button" class="btn btn-primary">Save</button>  
            </div>  
		</div>
	  </div>
	</div>
    <script src="js/jquery.min.js?v=2.1.4"></script>	
    <!-- Chosen -->
    <script src="js/plugins/chosen/chosen.jquery.js"></script>
    <script src="js/demo/form-advanced-demo.js"></script>
	<!-- jQuery Validation plugin javascript-->
    <script src="js/plugins/validate/jquery.validate.min.js"></script>
    <script src="js/plugins/validate/messages_zh.min.js"></script>

    <script src="js/demo/form-validate-demo.js"></script>
	<script src="js/plugins/iCheck/icheck.min.js"></script>
	<script>
		$(document).ready(function () {
			$('.i-checks').iCheck({
				checkboxClass: 'icheckbox_square-green',
				radioClass: 'iradio_square-green',
			});
		});
		var table=$('#editable').dataTable(
			{
			   iDisplayLength : 10000
			}
		);

    </script>
   
	<script>
	    $("select[name='plmid']").change(function(){
		document.getElementsByName("step")[0].innerHTML = "";
		document.getElementsByName("groupid")[0].innerHTML = "";
		var plmid=$(this).val();
		var aj = $.ajax({
				url:'__URL__/ajaxstep',
				data:{  
					plmid : plmid
				},
				type:'post',  
				cache:false,  
				dataType:'json',  
				success:function(data) {
					if(data!=null){
						var code="";
						for(var i=0;i<data.length;i++){
						code+="<option value='"+data[i]['pworktype']+"'>"+data[i]['pworktype']+"</option>";
						}
						$("select[name='step']").append(code);
					}					
					
				}  
			});
			
			
		var aj = $.ajax({
				url:'__URL__/ajaxgroup',
				data:{  
					plmid : plmid
				},
				type:'post',  
				cache:false,  
				dataType:'json',  
				success:function(data) {
					if(data!=null){
						var code="";
						for(var i=0;i<data.length;i++){
						code+="<option value='"+data[i]['id']+"'>"+data[i]['group']+"</option>";
						}
						$("select[name='groupid']").append(code);
						var groupid=document.getElementsByName("groupid")[0].value;
						$("#t_able").children().remove();
						var aj = $.ajax({
							url:'__URL__/ajaxgetWorkersByGroupId',
							data:{  
								groupid : groupid
							},
							type:'post',  
							cache:false,  
							dataType:'json',  
							success:function(data) {
								if(data!=null){
									var code="";
									for(var i=0;i<data.length;i++){
									//code+='<tr><td><input type="text" readonly class="form-control" size="12" name="para1[]" value="'+data[i]["number"]+'"></td><td><input type="text" readonly class="form-control" size="12" name="para2[]" value="'+data[i]["name"]+'" ></td><td><input type="text" readonly class="form-control" size="7" name="para3[]" value="'+data[i]["brand"]+'" ></td><td><input type="text" readonly class="form-control" size="7" name="para4[]" value="'+data[i]["standard"]+'" ></td><td><input type="text" readonly class="form-control" size="7" name="para5[]" value="'+data[i]["unit"]+'" ></td><td><input type="text" readonly class="form-control" size="10" name="para6[]" value="'+data[i]["supplier"]+'" ></td><td><input type="text" readonly class="form-control price" size="7" name="para7[]" value="'+data[i]["price"]+'"></td><td><input type="text" oninput="calcprice()" class="form-control count" size="7" name="para8[]" ></td></tr>';
									
									
									code+='<tr class="i-checks">\
											<td>'+data[i]["group"]+'<input type="hidden" value="'+data[i]["group"]+'" name="group_'+data[i]["deviceid"]+'"><input type="hidden" value="'+data[i]["groupid"]+'" name="groupid_'+data[i]["deviceid"]+'"></td>\
											<td>'+data[i]["source"]+'</td>\
											<td>'+data[i]["number"]+'</td>\
											<td>'+data[i]["device"]+'</td>\
											<td>'+data[i]["model"]+'</td>\
											<td>'+data[i]["plate"]+'</td>\
											<td class="i-checks">在岗<input type="radio" value="在岗" name="status_'+data[i]["deviceid"]+'" checked required="" aria-required="true">\
												离岗<input type="radio" value="离岗" name="status_'+data[i]["deviceid"]+'" required="" aria-required="true">\
											</td>\
											<td class="i-checks"><input type="text" value="0" class="form-control" name="money_'+data[i]["deviceid"]+'" checked required="" aria-required="true">\
											</td>\
										</tr>';
									}
									$("#t_able").append(code);
									$('.i-checks').iCheck({
										checkboxClass: 'icheckbox_square-green',
										radioClass: 'iradio_square-green',
									});
								}					
								
							}  
						});
					}		
				}
				})
		})
		
		
		$("select[name='groupid']").change(function(){
			var groupid=$(this).val();
			$("#t_able").children().remove();
			var aj = $.ajax({
				url:'__URL__/ajaxgetWorkersByGroupId',
				data:{  
					groupid : groupid
				},
				type:'post',  
				cache:false,  
				dataType:'json',  
				success:function(data) {
					if(data!=null){
						var code="";
						for(var i=0;i<data.length;i++){
						//code+='<tr><td><input type="text" readonly class="form-control" size="12" name="para1[]" value="'+data[i]["number"]+'"></td><td><input type="text" readonly class="form-control" size="12" name="para2[]" value="'+data[i]["name"]+'" ></td><td><input type="text" readonly class="form-control" size="7" name="para3[]" value="'+data[i]["brand"]+'" ></td><td><input type="text" readonly class="form-control" size="7" name="para4[]" value="'+data[i]["standard"]+'" ></td><td><input type="text" readonly class="form-control" size="7" name="para5[]" value="'+data[i]["unit"]+'" ></td><td><input type="text" readonly class="form-control" size="10" name="para6[]" value="'+data[i]["supplier"]+'" ></td><td><input type="text" readonly class="form-control price" size="7" name="para7[]" value="'+data[i]["price"]+'"></td><td><input type="text" oninput="calcprice()" class="form-control count" size="7" name="para8[]" ></td></tr>';
						
						
						code+='<tr class="i-checks">\
								<td>'+data[i]["group"]+'<input type="hidden" value="'+data[i]["group"]+'" name="group_'+data[i]["deviceid"]+'"><input type="hidden" value="'+data[i]["groupid"]+'" name="groupid_'+data[i]["deviceid"]+'"></td>\
								<td>'+data[i]["source"]+'</td>\
								<td>'+data[i]["number"]+'</td>\
								<td>'+data[i]["device"]+'</td>\
								<td>'+data[i]["model"]+'</td>\
								<td>'+data[i]["plate"]+'</td>\
								<td class="i-checks">在岗<input type="radio" value="在岗" name="status_'+data[i]["deviceid"]+'" checked required="" aria-required="true">\
									离岗<input type="radio" value="离岗" name="status_'+data[i]["deviceid"]+'" required="" aria-required="true">\
								</td>\
								<td class="i-checks"><input type="text" value="0" class="form-control" name="money_'+data[i]["deviceid"]+'" checked required="" aria-required="true">\
								</td>\
							</tr>';
						}
						$("#t_able").append(code);
						$('.i-checks').iCheck({
							checkboxClass: 'icheckbox_square-green',
							radioClass: 'iradio_square-green',
						});
					}					
					
				}  
			});
		})
	</script>
	<script>
	 function changeout(){
	 	var plm=$('select[name="plmid"]').val();
		var date=$('select[name="date"]').val();
		if(date==''){
			alert('请选择日期');
		}else if(plm==''){
			alert('请选择项目');
		}else{
			$("#btnclick").click();
		}
	 }
	
	</script>

    