
<link rel="shortcut icon" href="favicon.ico"> <link href="css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
<link href="css/font-awesome.css?v=4.4.0" rel="stylesheet">
<link href="css/plugins/iCheck/custom.css" rel="stylesheet">
<link href="css/animate.css" rel="stylesheet">
<link href="css/style.css?v=4.1.0" rel="stylesheet">
<link rel="stylesheet" href="css/main.css">

<div class="modal-header">
	<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span>
	</button>
	<h4 class="modal-title">设置施工计划</h4>
</div>
<form method="post" action="__APP__/Sgjh/insert/callbackType/closeCurrent/navTabId/Second" ENCTYPE="multipart/form-data" onsubmit="return iframeCallback(this, dialogAjaxDone)">
<div class="modal-body" id="file-pretty"> 
	<input type="hidden" value="{$orgdata.id}" name="id">
	<input type="hidden" value="{$change}" name="change">
	<div class="form-group">
		<label style="float:left">项目名称</label>
		<input type="text" placeholder="" class="form-control" readonly value="{$orgdata['title']}">
	</div>
	<table class="drafttable" style="position:relative;top:8px;margin:0 auto;width:100%;margin-bottom:28px;font-family:微软雅黑">
		<tr>
			<td class="normal" style="font-weight:bold;height:45px;background-color:#F5F5F6">专项</td>
			<td class="normal" style="font-weight:bold;height:45px;background-color:#F5F5F6">节点</td>
			<td class="normal" style="font-weight:bold;height:45px;background-color:#F5F5F6">计划开始时间</td>
			<td class="normal" style="font-weight:bold;height:45px;background-color:#F5F5F6">计划完成时间</td>
		</tr>
		
		<volist name="orgdata.worktype" id="worktype">
		<input type="hidden" name="pworktype[]" value="{$worktype.pworktype}">
		<input type="hidden" name="worktype[]" value="{$worktype.title}">
		<tr>
			<eq name="worktype.block" value="1">
			<td class="normal" rowspan="{$worktype.rowspan}" style="font-weight:bold;height:45px">{$worktype.pworktype}</td>
			</eq>
			<td class="normal" >
			{$worktype.title}
			</td>
			<td class="normal" >
			<input value="{$worktype[schedule][plantimebegin]}" type="text" style="position:relative;border:0px;border-bottom:1px solid #BBBBBB;height:25px;background:white;width:80px" name="plantimebegin[]" 
			<neq name="flag" value="0">onclick="laydate({istime: false, format: 'YYYY-MM-DD'})"</neq> placeholder="" <eq name="flag" value="0">readonly</eq> class="required">
			</td>
			<td class="normal" >
			<input value="{$worktype[schedule][plantimeend]}" type="text" style="position:relative;border:0px;border-bottom:1px solid #BBBBBB;height:25px;background:white;width:80px" name="plantimeend[]" 
			<neq name="flag" value="0">onclick="laydate({istime: false, format: 'YYYY-MM-DD'})"</neq> placeholder="" <eq name="flag" value="0">readonly</eq> class="required">
			</td>
		</tr>
		</volist>
		
	</table>
	
	<div class="form-group">
		<label style="float:left">竣工验收计划时间</label>
		<input type="text" placeholder="填写运营验收计划时间" class="form-control" name="predate100" <neq name="flag" value="0">onclick="laydate({istime: false, format: 'YYYY-MM-DD'})"</neq> value="{$orgdata['predate100']}" <eq name="flag" value="0">readonly</eq>>
	</div>
	<div class="form-group" style="display:none">
		<label style="float:left">项目验收计划时间</label>
		<input type="text" placeholder="填写项目验收计划时间" class="form-control" name="predate101" <neq name="flag" value="0">onclick="laydate({istime: false, format: 'YYYY-MM-DD'})"</neq> value="{$orgdata['predate101']}" <eq name="flag" value="0">readonly</eq>>
	</div>
	<div class="form-group" style="display:none">
		<label style="float:left">项目投运计划时间</label>
		<input type="text" placeholder="填写项目投运计划时间" class="form-control" name="predate102" <neq name="flag" value="0">onclick="laydate({istime: false, format: 'YYYY-MM-DD'})"</neq>value="{$orgdata['predate102']}" <eq name="flag" value="0">readonly</eq>>
	</div>
	
	
	<eq name="change" value="1">
	<div class="form-group">
		<label style="float:left">变更原因</label>
		<input type="text" placeholder="填写变更原因" class="form-control" name="reason" value="">
	</div>
	</eq>
	
	<eq name="flag" value="0">
	<div class="form-group">
		<label style="float:left;color:red;font-weight:bold">施工计划初始化：请填写开工日期，由系统自动生成计划时间</label>
		<input type="text" placeholder="请填写开工日期，由系统自动生成计划时间" class="form-control" name="start" value="" id="start" onclick="takeit();" onchange="takeit1(this.value)">
		<!-- <a href="javascript:void(0)" onclick="takeit0()" class="btn btn-info btn-xs" style="margin-left:0px;float:right">根据任务单派发时间自动生成</a> -->
	</div>
	<script>
	var id="<?php echo $orgdata["id"];?>";
	var initdate="<?php echo date("Y-m-d",strtotime($orgdata["predate9x"])+24*60*60);?>";
	function takeit0()
	{
		document.getElementById("start").value=initdate;
		var aj = $.ajax({
			url:'__APP__/Sgjh/add_auto',
			data:{
				id:id,
				date:initdate
			},
			type:'post',  
			cache:false,  
			dataType:'json',
			success:function(data) {
				console.log(data.schedules);
				for(var i=0;i<data["schedules"].length;i++){
					$("input[name='plantimebegin[]']:eq("+i+")").val(data["schedules"][i]['timebegin']);
					$("input[name='plantimeend[]']:eq("+i+")").val(data["schedules"][i]['timeend']);
				}
				
				$("input[name='predate100']").val(data["predate"][100]);
				$("input[name='predate101']").val(data["predate"][101]);
				$("input[name='predate102']").val(data["predate"][102]);
			}  
		});
	}
	function takeit()
	{
		laydate({
			istime: false,
			istoday: false,
			format: 'YYYY-MM-DD',
			choose: function(value, date)
			{
				//alert('你选择的日期是：' + value + '\n获得的对象是' + JSON.stringify(date));
				
				var aj = $.ajax({
					url:'__APP__/Sgjh/add_auto',
					data:{
						id:id,
						date:value
					},
					type:'post',  
					cache:false,  
					dataType:'json',
					success:function(data) {
						console.log(data.schedules);
						for(var i=0;i<data["schedules"].length;i++){
							$("input[name='plantimebegin[]']:eq("+i+")").val(data["schedules"][i]['timebegin']);
							$("input[name='plantimeend[]']:eq("+i+")").val(data["schedules"][i]['timeend']);
						}
						
						$("input[name='predate100']").val(data["predate"][100]);
						$("input[name='predate101']").val(data["predate"][101]);
						$("input[name='predate102']").val(data["predate"][102]);
					}  
				});
			
			}
		});
	}
	function takeit1(value)
	{
		var aj = $.ajax({
			url:'__APP__/Sgjh/add_auto',
			data:{
				id:id,
				date:value
			},
			type:'post',  
			cache:false,  
			dataType:'json',
			success:function(data) {
				console.log(data.schedules);
				for(var i=0;i<data["schedules"].length;i++){
					$("input[name='plantimebegin[]']:eq("+i+")").val(data["schedules"][i]['timebegin']);
					$("input[name='plantimeend[]']:eq("+i+")").val(data["schedules"][i]['timeend']);
				}
				
				$("input[name='predate100']").val(data["predate"][100]);
				$("input[name='predate101']").val(data["predate"][101]);
				$("input[name='predate102']").val(data["predate"][102]);
			}  
		});
	}
	</script>
	</eq>
</div>
<div class="modal-footer">
	<button type="submit" class="btn btn-danger">提交</button>
	<button type="button" class="btn btn-white" data-dismiss="modal">关闭</button>
</div>



</form>

<!-- Prettyfile -->
<script src="js/plugins/prettyfile/bootstrap-prettyfile.js"></script>
<script>
	$('input[type="file"]').prettyFile();
</script>