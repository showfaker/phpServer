
<script type="text/javascript" >
	function getrootpath() {
		//获取当前网址，如： http://localhost:8080/ems/Pages/Basic/Person.jsp
		var curWwwPath = window.document.location.href;
		//获取主机地址之后的目录，如： /ems/Pages/Basic/Person.jsp
		var pathName = window.document.location.pathname;
		var pos = curWwwPath.indexOf(pathName);
		//获取主机地址，如： http://localhost:8080
		var localhostPath = curWwwPath.substring(0, pos);
		//获取带"/"的项目名，如：/ems
		var projectName = pathName.substring(0, pathName.substr(1).indexOf('/') + 1);
		projectName = projectName.replace("/Rbac","");
		return(localhostPath + projectName);
	}

	function selectGroupmulti(arg1,arg2){
		var rootpath=getrootpath();
		asyncbox.open({
			id : "form",
			title:'',
			url :rootpath+'/Rbac/index.php?s=/Public/selectmulti/arg1/'+arg1+'/arg2/'+arg2,
			width : 445,
			height : 400,
			//btnsbar : $.btn.ok,
			callback : function(action){
				if(action == 'close'){  
					return;
				}
			}
		});
	}

	function selectGroup(arg1,arg2){
		var rootpath=getrootpath();
		asyncbox.open({
			id : "form",
			title:'',
			url :rootpath+'/Rbac/index.php?s=/Public/select/arg1/'+arg1+'/arg2/'+arg2,
			width : 445,
			height : 400,
			//btnsbar : $.btn.ok,
			callback : function(action){
				if(action == 'close'){  
					return;
				}
			}
		});
	}
	function selectWorker(arg1,arg2){
		var rootpath=getrootpath();
		asyncbox.open({
			id : "form",
			title:'',
			url :rootpath+'/Rbac/index.php?s=/Public/selectworker/arg1/'+arg1+'/arg2/'+arg2,
			width : 445,
			height : 400,
			//btnsbar : $.btn.ok,
			callback : function(action){
				if(action == 'close'){  
					return;
				}
			}
		});
	}
</script>
<div class="modal-header" style="text-align: left;">
	<button type="button" class="close" data-dismiss="modal">×</button>
	<h4 class="modal-title" >更新专项职能计划</h4>
</div>
<form method="post" action="__URL__/update" class="form-horizontal">
	<div class="modal-body" >
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">所属项目<font style="color:red">*</font>：</label>
			<div class="col-sm-8 col-xs-8">
				<select name="plmid" data-placeholder="选择项目" class="form-control" required>
					<option value="">请选择项目</option>
					<volist name="allprojects" id="project">
						<option value="{$project.id}" hassubinfo="true" <eq name="project.id" value="$vo.plmid">selected</eq>>{$project.title}</option>
					</volist>
				</select>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">计划名称<font style="color:red">*</font>：</label>
			<div class="col-sm-8 col-xs-8">
				<input class="form-control" type="text" name="title" size="60" required>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">组织<font style="color:red">*</font>：</label>
			<div class="col-sm-8 col-xs-8">
				<select name="organize" id="organize" class="form-control" required>
					<option value="">请选择组织</option>
					<option value="公司">公司</option>
					<option value="部门">部门</option>
					<option value="个人">个人</option>
				</select>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">计划期间<font style="color:red">*</font>：</label>
			<div class="col-sm-8 col-xs-8">
				<select name="period" id="period" class="form-control" required>
					<option value="">请选择计划期间</option>
					<option value="月度">月度</option>
					<option value="季度">季度</option>
					<option value="年度">年度</option>
				</select>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">计划开始日期<font style="color:red">*</font>：</label>
			<div class="col-sm-8 col-xs-8">
				<input type="date" name="timebegin" class="form-control" dateFmt="yyyy-MM-dd"  value="<?php echo date('Y-m-d',time());?>" required/>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">计划结束日期<font style="color:red">*</font>：</label>
			<div class="col-sm-8 col-xs-8">
				<input type="date" name="timeend" class="form-control" dateFmt="yyyy-MM-dd"  value="<?php echo date('Y-m-d',time());?>" required/>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 col-xs-3 control-label">工作事项：</label>
			<div class="col-sm-2 col-xs-2">
				<a onclick="fnClickAddRow();" href="javascript:void(0);" class="btn btn-primary ">添加行</a>
			</div>
			<!-- <div class="col-sm-3">
				<select name="" id="" class="form-control" onchange="setdesign_status(this.value)">
					<option value="">批量请选择组织</option>
					<option value="公司">公司</option>
					<option value="部门">部门</option>
					<option value="个人">个人</option>
				</select>
			</div> -->
			<div class="col-sm-3 col-xs-3">
				<input type="text" id="current" name="current" class="form-control" placeholder="责任人" onchange="current_change(this.value)">
			</div>
		</div>
		<div class="form-group">
			<div class="col-sm-12 col-xs-12">
				<table class="table table-striped table-bordered table-hover" id="editable">
					<thead>
						<tr>
							<th width="70%">工作事项</th>
							<th width="20%">责任人</th>
							<th width="10%">操作</th>
						</tr>
					</thead>
					<tbody>
						<tr id="table-row-0">
							<td>
								<input type="text" placeholder="工作事项" class="form-control" style="width:100%" name="para1[]" id="para1">
							</td>
							<td>
								<input type="text" placeholder="责任人" class="form-control para2" name="para2[]" id="para2">
							</td>             
							<td>						
								<a class="btn btn-danger btn-xs delete" href="javascript:void(0);">删除</a>
							</td>				
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<input type="hidden" name="id" value="{$vo.id}">
	<div class="modal-footer">
		<button type="button" class="btn btn-sm btn-white pull-right m-t-n-xs" data-dismiss="modal" style="margin-left:10px">关闭</button>
		<button class="btn btn-sm btn-primary pull-right m-t-n-xs" type="submit" id='submit'><strong>确定</strong>
		</button>
	</div>
</form>
<script>
	var currentrow=1;
	function fnClickAddRow(){
		$('#editable').dataTable().fnAddData([
			'<input type="text" placeholder="工作事项" style="width:100%" class="form-control" name="para1[]" id="para1">',
			'<input type="text" placeholder="责任人" class="form-control para2" name="para2[]" id="para2">',
			'<a class="btn btn-danger btn-xs delete" href="javascript:void(0);">删除</a>'
		]);
		currentrow++;
		$('.delete').on('click', function(e) {
			var table = $('#editable').DataTable();
			table.row($(this).parents('tr')).remove().draw();
		});
	}
	$('.delete').on('click', function(e){
		var table = $('#editable').DataTable();
		table.row($(this).parents('tr')).remove().draw();
	});
</script>
<script>
	function current_change(e){
		$(".para2").val(e);
	}
</script>